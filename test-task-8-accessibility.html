<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 8 - Accessibility Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }
        .modal:not(.hidden) {
            display: flex;
        }
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            position: relative;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            z-index: 1001;
        }
        .modal.stacked {
            z-index: 1100;
        }
    </style>
</head>
<body>
    <h1>Task 8: Accessibility Verification Tests</h1>
    
    <div class="test-section">
        <h2>Test 1: ARIA Attributes</h2>
        <p>Verify that modals have proper ARIA attributes</p>
        <button onclick="testAriaAttributes()">Run Test</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Focus Management</h2>
        <p>Verify that focus is set to modal when opened and restored when closed</p>
        <button id="open-settings-test" onclick="testFocusManagement()">Run Test</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Close Button Accessibility</h2>
        <p>Verify that close buttons have proper aria-label attributes</p>
        <button onclick="testCloseButtonAccessibility()">Run Test</button>
        <div id="test3-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Keyboard Navigation</h2>
        <p>Verify that modals can be closed with ESC key (already implemented in task 7)</p>
        <button onclick="testKeyboardNavigation()">Run Test</button>
        <div id="test4-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Cascading Close Focus Restoration</h2>
        <p>Verify focus restoration works correctly when closing category modal from settings</p>
        <button id="open-settings-cascade" onclick="testCascadingFocus()">Run Test</button>
        <div id="test5-result"></div>
    </div>

    <script>
        function showResult(testId, passed, message) {
            const resultDiv = document.getElementById(testId);
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.textContent = `${passed ? '✓ PASS' : '✗ FAIL'}: ${message}`;
        }

        function testAriaAttributes() {
            const categoryModal = document.getElementById('category-modal');
            const settingsModal = document.getElementById('settings-modal');
            
            const checks = [
                categoryModal?.getAttribute('role') === 'dialog',
                categoryModal?.getAttribute('aria-modal') === 'true',
                categoryModal?.getAttribute('aria-labelledby') === 'category-modal-title',
                settingsModal?.getAttribute('role') === 'dialog',
                settingsModal?.getAttribute('aria-modal') === 'true',
                settingsModal?.getAttribute('aria-labelledby') === 'settings-modal-title',
                document.getElementById('category-modal-title') !== null,
                document.getElementById('settings-modal-title') !== null
            ];
            
            const allPassed = checks.every(check => check);
            showResult('test1-result', allPassed, 
                allPassed ? 'All ARIA attributes are properly set' : 'Some ARIA attributes are missing');
        }

        function testFocusManagement() {
            const settingsBtn = document.getElementById('open-settings-test');
            const originalFocus = document.activeElement;
            
            // Simulate opening settings modal
            setTimeout(() => {
                const app = window.app;
                if (app) {
                    app.openSettingsModal();
                    
                    setTimeout(() => {
                        const modal = document.getElementById('settings-modal');
                        const focusedElement = document.activeElement;
                        const isFocusInModal = modal?.contains(focusedElement);
                        
                        // Close modal
                        app.closeSettingsModal();
                        
                        setTimeout(() => {
                            const focusRestored = document.activeElement === settingsBtn || 
                                                 document.activeElement.id === settingsBtn.id;
                            
                            showResult('test2-result', isFocusInModal && focusRestored,
                                isFocusInModal && focusRestored ? 
                                'Focus is properly managed (set on open, restored on close)' :
                                'Focus management has issues');
                        }, 200);
                    }, 200);
                } else {
                    showResult('test2-result', false, 'App not initialized');
                }
            }, 100);
        }

        function testCloseButtonAccessibility() {
            const categoryCloseBtn = document.getElementById('close-category-modal');
            const settingsCloseBtn = document.getElementById('close-settings-modal');
            
            const checks = [
                categoryCloseBtn?.getAttribute('aria-label')?.includes('Cerrar'),
                settingsCloseBtn?.getAttribute('aria-label')?.includes('Cerrar')
            ];
            
            const allPassed = checks.every(check => check);
            showResult('test3-result', allPassed,
                allPassed ? 'All close buttons have proper aria-label attributes' : 
                'Some close buttons are missing aria-label');
        }

        function testKeyboardNavigation() {
            const app = window.app;
            if (!app) {
                showResult('test4-result', false, 'App not initialized');
                return;
            }
            
            // Open settings modal
            app.openSettingsModal();
            
            setTimeout(() => {
                const settingsModal = document.getElementById('settings-modal');
                const isOpen = !settingsModal.classList.contains('hidden');
                
                if (isOpen) {
                    // Simulate ESC key press
                    const escEvent = new KeyboardEvent('keydown', { key: 'Escape' });
                    document.dispatchEvent(escEvent);
                    
                    setTimeout(() => {
                        const isClosed = settingsModal.classList.contains('hidden');
                        showResult('test4-result', isClosed,
                            isClosed ? 'ESC key closes modal (keyboard accessible)' :
                            'ESC key does not close modal');
                    }, 200);
                } else {
                    showResult('test4-result', false, 'Modal did not open');
                }
            }, 200);
        }

        function testCascadingFocus() {
            const cascadeBtn = document.getElementById('open-settings-cascade');
            const app = window.app;
            
            if (!app) {
                showResult('test5-result', false, 'App not initialized');
                return;
            }
            
            // Open settings modal
            app.openSettingsModal();
            
            setTimeout(() => {
                // Open category modal from settings
                app.showCategoryModal(true);
                
                setTimeout(() => {
                    // Close category modal (should cascade close settings)
                    app.closeCategoryModal();
                    
                    setTimeout(() => {
                        const settingsModal = document.getElementById('settings-modal');
                        const categoryModal = document.getElementById('category-modal');
                        const bothClosed = settingsModal.classList.contains('hidden') && 
                                         categoryModal.classList.contains('hidden');
                        
                        showResult('test5-result', bothClosed,
                            bothClosed ? 'Cascading close works and focus is managed' :
                            'Cascading close or focus restoration failed');
                    }, 300);
                }, 200);
            }, 200);
        }
    </script>

    <p style="margin-top: 40px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
        <strong>Note:</strong> This test file verifies the accessibility improvements made in Task 8:
        <ul>
            <li>✓ ARIA attributes (role="dialog", aria-modal="true", aria-labelledby)</li>
            <li>✓ Focus management (focus set on open, restored on close)</li>
            <li>✓ Close button accessibility (aria-label attributes)</li>
            <li>✓ Keyboard navigation (ESC key support from Task 7)</li>
            <li>✓ Focus restoration in cascading close scenarios</li>
        </ul>
    </p>
</body>
</html>
