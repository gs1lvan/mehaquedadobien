<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">mehaquedadobien üç≥</title>

    <!-- Open Graph meta tags for WhatsApp preview -->
    <meta property="og:title" content="mehaquedadobien üç≥" id="og-title">
    <meta property="og:description" content="Recetario personal - Comparte y guarda tus recetas favoritas"
        id="og-description">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gs1lvan.github.io/mehaquedadobien/">

    <!-- Apply theme immediately to prevent flash -->
    <script>
        (function () {
            const theme = localStorage.getItem('recetario_theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }

            // Update title if importing recipe
            const urlParams = new URLSearchParams(window.location.search);
            const recipeName = urlParams.get('r');
            if (recipeName) {
                const decodedName = decodeURIComponent(recipeName);
                document.title = `${decodedName} - mehaquedadobien üç≥`;
                const ogTitle = document.getElementById('og-title');
                if (ogTitle) ogTitle.setAttribute('content', `${decodedName} - mehaquedadobien üç≥`);
                const ogDesc = document.getElementById('og-description');
                if (ogDesc) ogDesc.setAttribute('content', `Receta: ${decodedName}`);
            }
        })();
    </script>

    <link rel="stylesheet" href="styles.css">

    <!-- Font Awesome Icons - Para icono de l√°piz en nombre de receta -->
    <!-- Si deseas eliminar Font Awesome, borra esta l√≠nea y el icono en script.js (buscar: fa-pencil) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Fin Font Awesome -->

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="mehaquedadobien">
</head>

<body>
    <div class="container">
        <!-- Header with title and new recipe button -->
        <header class="recipe-header">
            <div class="header-content">
                <div class="header-left">
                    <h1><a href="#" id="home-link" style="text-decoration: none; color: inherit;">üç≥ mehaquedadobien</a>
                    </h1>
                    <!-- Theme toggle button (square format) -->
                    <button id="theme-toggle-btn" class="btn-icon theme-toggle-square" title="Cambiar a tema oscuro"
                        aria-label="Cambiar a tema oscuro">
                        üåô
                    </button>
                </div>

                <!-- Menu button (always visible) -->
                <button id="menu-btn" class="menu-btn" title="Men√∫" aria-label="Men√∫ de opciones" aria-expanded="false"
                    aria-haspopup="true">
                    <span class="hamburger-icon">‚ò∞</span>
                </button>

                <!-- Dropdown menu -->
                <div id="menu-dropdown" class="menu-dropdown" role="menu" aria-label="Opciones de la aplicaci√≥n">
                    <button id="manage-categories-btn" class="menu-item" role="menuitem" title="Gestionar categor√≠as">
                        üè∑Ô∏è Categor√≠as
                    </button>
                    <button id="shopping-lists-btn" class="menu-item" role="menuitem"
                        title="Gestionar listas de compra">
                        üõí Listas de Compra
                    </button>
                    <button id="menus-btn" class="menu-item" role="menuitem" title="Gestionar men√∫s">
                        üìã Men√∫s
                    </button>
                    <button id="import-xml-btn" class="menu-item" role="menuitem" title="Importar recetas desde XML">
                        üì• Importar receta
                    </button>
                    <button id="export-all-btn" class="menu-item" role="menuitem" title="Exportar todas las recetas">
                        üì§ Exportar todas las recetas
                    </button>
                    <button id="new-recipe-btn" class="menu-item menu-item-primary" role="menuitem"
                        title="Crear nueva receta">
                        ‚ûï Nueva Receta
                    </button>
                </div>

                <!-- Hidden file input for XML import -->
                <input type="file" id="xml-file-input" accept=".xml" style="display: none;">
            </div>
        </header>

        <main>
            <!-- Filter toggle button -->
            <div class="filter-toggle-container">
                <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                    <button id="toggle-filters-btn" class="btn-toggle-filters">
                        üîç Filtros
                    </button>
                    <button id="clear-all-filters-btn" class="btn-clear-filters hidden">
                        üóëÔ∏è Limpiar filtros
                    </button>
                    <div class="view-toggle-buttons">
                        <button id="view-grid-btn" class="btn-view-toggle active" title="Vista de tarjetas">
                            üî≤
                        </button>
                        <button id="view-list-btn" class="btn-view-toggle" title="Vista de lista">
                            ‚ò∞
                        </button>
                    </div>
                </div>
                <button id="new-recipe-btn-home" class="btn-new-recipe-home">
                    ‚ûï Nueva Receta
                </button>
            </div>

            <!-- Filters container (collapsible) -->
            <div id="filters-container" class="filters-container hidden">
                <!-- Filter bar with category chips -->
                <section id="filter-bar" class="filter-bar">
                    <h2 class="filter-title">Filtrar por alimento:</h2>
                    <div class="filter-chips">
                        <button class="filter-chip" data-category="all">
                            Todas
                        </button>
                        <button class="filter-chip" data-category="carne">
                            ü•© Carne
                        </button>
                        <button class="filter-chip" data-category="verdura">
                            ü•¨ Verdura
                        </button>
                        <button class="filter-chip" data-category="pescado">
                            üêü Pescado
                        </button>
                        <button class="filter-chip" data-category="fruta">
                            üçé Fruta
                        </button>
                        <button class="filter-chip" data-category="cereales">
                            üåæ Cereales
                        </button>
                        <button class="filter-chip" data-category="con-huevo">
                            ü•ö Con huevo
                        </button>
                        <button class="filter-chip" data-category="pollo">
                            üêî Pollo
                        </button>
                        <button class="filter-chip" data-category="escabeche">
                            ü•í Escabeche
                        </button>
                        <button class="filter-chip" data-category="caravana">
                            üöê Caravana
                        </button>
                    </div>
                </section>

                <!-- TEMPORALMENTE OCULTO - Filtro de tiempo (2025-11-04)
                <section id="time-filter-bar" class="filter-bar">
                    <h2 class="filter-title">Filtrar por tiempo:</h2>
                    <div class="filter-chips" id="time-filter-chips">
                        <button class="filter-chip active" data-time="all">
                            Todos
                        </button>
                        <button class="filter-chip" data-time="15">
                            ‚è±Ô∏è 15 min
                        </button>
                        <button class="filter-chip" data-time="30">
                            ‚è±Ô∏è 30 min
                        </button>
                        <button class="filter-chip" data-time="45">
                            ‚è±Ô∏è 45 min
                        </button>
                        <button class="filter-chip" data-time="60">
                            ‚è±Ô∏è 1h
                        </button>
                        <button class="filter-chip" data-time="120">
                            ‚è±Ô∏è 2h
                        </button>
                        <button class="filter-chip" data-time="180">
                            ‚è±Ô∏è 3h
                        </button>
                    </div>
                </section>
                -->
            </div>
            <!-- End filters container -->

            <!-- Recipe counter -->
            <div id="recipe-counter" class="recipe-counter">
                <span id="recipe-count-text">0 recetas</span>
            </div>

            <!-- Recipe grid -->
            <section id="recipe-list-view" class="recipe-list">
                <!-- List view header (only visible in list mode) -->
                <div id="list-view-header" class="list-view-header hidden">
                    <div class="list-header-img"></div>
                    <div class="list-header-name" id="sort-by-name">
                        NOMBRE <span class="sort-indicator"></span>
                    </div>
                    <div class="list-header-date" id="sort-by-date">
                        FECHA <span class="sort-indicator">‚ñº</span>
                    </div>
                    <div class="list-header-actions"></div>
                </div>

                <div id="recipes-grid" class="recipes-grid">
                    <!-- Recipe cards will be dynamically inserted here -->
                    <!-- Example structure:
                    <div class="recipe-card" data-recipe-id="uuid">
                        <div class="recipe-image">
                            <img src="..." alt="Recipe name">
                        </div>
                        <div class="recipe-content">
                            <h3 class="recipe-name">Recipe Name</h3>
                            <span class="recipe-category">Category</span>
                            <p class="recipe-preview">Ingredients preview...</p>
                        </div>
                    </div>
                    -->
                </div>

                <!-- Empty state -->
                <div id="empty-state" class="empty-state hidden">
                    <div class="empty-state-icon">üìñ</div>
                    <h3>No hay recetas todav√≠a</h3>
                    <p>Comienza creando tu primera receta</p>
                    <button class="btn-primary" onclick="document.getElementById('new-recipe-btn').click()">
                        ‚ûï Crear Primera Receta
                    </button>
                </div>
            </section>

            <!-- Recipe Detail View -->
            <section id="recipe-detail-view" class="recipe-detail hidden">
                <div class="detail-header">
                    <button id="back-to-list-btn" class="btn-icon" title="Volver a la lista">‚óÄ</button>
                    <div class="detail-header-content">
                        <div>
                            <div
                                style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-xs); flex-wrap: wrap;">
                                <span id="detail-category" class="recipe-category" style="display: none;">Sin
                                    categor√≠a</span>
                                <span id="detail-total-time" class="recipe-total-time" style="display: none;"></span>
                            </div>
                            <h2 id="detail-recipe-name"
                                style="font-size: 2.65rem; cursor: pointer; position: relative;">Conejo al ajillo <i
                                    class="fa-solid fa-pencil recipe-name-edit-icon"></i>
                                <div class="recipe-name-tooltip">Editar receta</div>
                            </h2>
                            <div class="detail-meta"
                                style="display: flex; flex-direction: column; align-items: flex-start; gap: var(--spacing-xs); margin-top: var(--spacing-xs);">
                                <span id="detail-caravan-badge" class="recipe-caravan-badge" style="display: none;">Apto
                                    para Caravana</span>
                                <span id="detail-hospital-badge" class="recipe-hospital-badge"
                                    style="display: none;">Apto
                                    para Hospital</span>
                                <span id="detail-menu-badge" class="recipe-menu-badge" style="display: none;">Para
                                    Men√∫</span>
                            </div>
                        </div>
                        <!-- MOVIDO A FORMULARIO - Botones de acci√≥n (2025-11-04)
                        <div class="detail-actions">
                            <button id="edit-recipe-btn" class="btn-action btn-action-compact"
                                title="Editar">Editar</button>
                            <button id="duplicate-recipe-btn" class="btn-action btn-action-compact"
                                title="Duplicar">Duplicar</button>
                            <button id="delete-recipe-btn" class="btn-action btn-action-compact btn-danger"
                                title="Eliminar">Eliminar</button>
                            <button id="share-recipe-btn" class="btn-action btn-action-compact"
                                title="Compartir receta">Compartir</button>
                            <button id="export-xml-btn" class="btn-action btn-action-compact"
                                title="Exportar esta receta">Exportar</button>
                            <button id="export-pdf-btn" class="btn-action btn-action-compact"
                                title="Exportar PDF">PDF</button>
                        </div>
                        -->
                    </div>
                </div>

                <div class="detail-content">
                    <!-- Multimedia Gallery -->
                    <div id="detail-multimedia-section" class="detail-section" style="display: none;">
                        <div id="detail-images-gallery" class="detail-gallery"></div>
                    </div>

                    <!-- Kitchen Appliances / M√©todo de Preparaci√≥n -->
                    <div id="detail-appliances-section" class="detail-section" style="display: none;">
                        <h3 class="detail-section-title">üë®‚Äçüç≥ M√©todo de Preparaci√≥n</h3>
                        <div id="detail-appliances-chips" class="kitchen-appliances-chips">
                            <!-- Appliances will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Ingredients -->
                    <div class="detail-section">
                        <div class="detail-section-header">
                            <h3 class="detail-section-title">ü•ò Ingredientes</h3>
                        </div>
                        <ul id="detail-ingredients-list" class="detail-ingredients-list">
                            <!-- Ingredients will be dynamically added here -->
                        </ul>
                        <div id="detail-no-ingredients" class="detail-empty" style="display: none;">
                            <p>No hay ingredientes definidos</p>
                        </div>
                    </div>

                    <!-- Addition Sequences -->
                    <div id="detail-sequences-section" class="detail-section" style="display: none;">
                        <h3 class="detail-section-title">üî¢ Secuencias de Adici√≥n</h3>
                        <div id="detail-sequences-list" class="detail-sequences-list">
                            <!-- Sequences will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Metadata -->
                    <div class="detail-section">
                        <h3 class="detail-section-title">‚ÑπÔ∏è Informaci√≥n</h3>

                        <!-- Additional Information (Author and History) -->
                        <div id="detail-additional-info-section" style="display: none; margin-bottom: 24px;">
                            <div id="detail-author-section" class="detail-sequence-item" style="display: none;">
                                <div class="sequence-header">
                                    <span class="sequence-number">Autor</span>
                                </div>
                                <div id="detail-author" class="sequence-description"></div>
                            </div>
                            <div id="detail-history-section" class="detail-sequence-item" style="display: none;">
                                <div class="sequence-header">
                                    <span class="sequence-number">Historia</span>
                                </div>
                                <div id="detail-history" class="sequence-description"></div>
                            </div>
                        </div>

                        <div class="detail-metadata">
                            <div class="metadata-grid">
                                <div class="metadata-item">
                                    <span class="metadata-label">Creada:</span>
                                    <span id="detail-created-at" class="metadata-value">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">√öltima modificaci√≥n:</span>
                                    <span id="detail-updated-at" class="metadata-value">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">ID:</span>
                                    <span id="detail-recipe-id" class="metadata-value">-</span>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </section>

            <!-- Recipe Form (Create/Edit) -->
            <section id="recipe-form-view" class="recipe-form hidden">
                <div class="form-header">
                    <h2 id="recipe-name" class="editable-title" contenteditable="true"
                        data-placeholder="Nombre de la receta...">Nueva Receta</h2>
                    <button id="close-form-btn" class="btn-icon" title="Cerrar">‚úï</button>
                </div>

                <div class="detail-actions" id="form-actions" style="display: none;">
                    <!-- OCULTO - Bot√≥n Editar en formulario (2025-11-04)
                    <button id="edit-recipe-btn" class="btn-action btn-action-compact"
                        title="Editar">Editar</button>
                    -->
                    <!-- TEMPORALMENTE OCULTO - Bot√≥n Duplicar (2025-11-03)
                    <button id="duplicate-recipe-btn" class="btn-action btn-action-compact"
                        title="Duplicar">Duplicar</button>
                    -->
                    <button id="delete-recipe-btn" class="btn-action btn-action-compact btn-danger"
                        title="Eliminar">Eliminar</button>
                    <button id="share-recipe-btn" class="btn-action btn-action-compact"
                        title="Compartir receta">Compartir</button>
                    <button id="export-xml-btn" class="btn-action btn-action-compact"
                        title="Exportar esta receta">Exportar</button>
                    <button id="export-pdf-btn" class="btn-action btn-action-compact" title="Exportar PDF">PDF</button>
                </div>

                <form id="recipe-form" class="recipe-form-content">
                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h3 class="section-title">Informaci√≥n B√°sica</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipe-category-chip">Categor√≠a</label>
                                <button type="button" id="recipe-category-chip" class="category-chip" data-category="">
                                    <span id="selected-category-display">Sin categor√≠a</span>
                                </button>
                                <input type="hidden" id="recipe-category" name="category" value="">
                            </div>

                            <div class="form-group">
                                <label>Tiempo Total (opcional)</label>
                                <div class="time-input-group">
                                    <div class="time-input-item">
                                        <span class="time-label">Horas</span>
                                        <input type="number" id="recipe-hours" class="form-input time-input"
                                            placeholder="0" min="0" max="24" autocomplete="off">
                                    </div>
                                    <div class="time-input-item">
                                        <span class="time-label">Minutos</span>
                                        <input type="number" id="recipe-minutes" class="form-input time-input"
                                            placeholder="0" min="0" max="59" autocomplete="off">
                                    </div>
                                </div>
                                <span class="helper-text">Si lo dejas vac√≠o, se establecer√° autom√°ticamente en 59
                                    minutos</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-badges-grid">
                                <div class="checkbox-badge-container" data-checkbox="recipe-caravan-friendly">
                                    <input type="checkbox" id="recipe-caravan-friendly" name="caravanFriendly"
                                        class="form-checkbox-hidden">
                                    <span class="checkbox-badge">üöê</span>
                                    <span class="checkbox-text">Caravana</span>
                                </div>

                                <div class="checkbox-badge-container" data-checkbox="recipe-hospital-friendly">
                                    <input type="checkbox" id="recipe-hospital-friendly" name="hospitalFriendly"
                                        class="form-checkbox-hidden">
                                    <span class="checkbox-badge">üè•</span>
                                    <span class="checkbox-text">Hospital</span>
                                </div>

                                <div class="checkbox-badge-container" data-checkbox="recipe-menu-friendly">
                                    <input type="checkbox" id="recipe-menu-friendly" name="menuFriendly"
                                        class="form-checkbox-hidden">
                                    <span class="checkbox-badge">üçΩÔ∏è</span>
                                    <span class="checkbox-text">Men√∫</span>
                                </div>
                            </div>
                            <!-- <span class="helper-text">Marca esta opci√≥n si la receta es adecuada para preparar en caravana</span> -->
                            <!-- <span class="helper-text">Marca esta opci√≥n si la receta es adecuada para dieta hospitalaria</span> -->
                            <!-- <span class="helper-text">Marca esta opci√≥n si la receta es adecuada para incluir en men√∫s</span> -->
                        </div>
                    </div>

                    <!-- Ingredients Section -->
                    <div class="form-section">
                        <h3 class="section-title collapsible-title" id="ingredients-section-title">
                            <span class="collapse-icon">‚ñº</span> Ingredientes
                        </h3>
                        <div id="ingredients-collapsible-content" class="collapsible-content">
                            <div id="ingredients-container">
                                <!-- Add ingredient form -->
                                <div class="ingredient-add-form">
                                    <div class="ingredient-inputs">
                                        <div class="ingredient-input-group" style="position: relative;">
                                            <label for="ingredient-name">Nombre (libre)</label>
                                            <input type="text" id="ingredient-name" class="form-input ingredient-input"
                                                placeholder="Ej: Pollo" autocomplete="off">
                                            <div id="ingredient-autocomplete" class="autocomplete-suggestions"
                                                style="display: none;"></div>
                                        </div>
                                        <div class="ingredient-input-group">
                                            <label for="ingredient-quantity">Cantidad (libre y opcional)</label>
                                            <input type="number" id="ingredient-quantity"
                                                class="form-input ingredient-input" placeholder="500" min="0"
                                                step="0.01" autocomplete="off">
                                        </div>
                                        <div class="ingredient-input-group">
                                            <label for="ingredient-unit">Unidad (opcional)</label>
                                            <select id="ingredient-unit" class="form-select ingredient-input">
                                                <option value="">Seleccionar</option>
                                                <option value="g">g (gramos)</option>
                                                <option value="kg">kg (kilogramos)</option>
                                                <option value="ml">ml (mililitros)</option>
                                                <option value="l">l (litros)</option>
                                                <option value="taza">taza</option>
                                                <option value="cucharada">cucharada</option>
                                                <option value="cucharadita">cucharadita</option>
                                                <option value="pizca">pizca</option>
                                                <option value="unidad">unidad</option>
                                                <option value="al gusto">al gusto</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button type="button" id="add-ingredient-btn" class="btn-add-ingredient">
                                        ‚ûï A√±adir Ingrediente
                                    </button>
                                    <span class="error-message" id="ingredient-error"></span>
                                </div>

                                <!-- Ingredients list -->
                                <div id="ingredients-list" class="ingredients-list">
                                    <!-- Ingredients will be dynamically added here -->
                                </div>

                                <div id="ingredients-empty" class="ingredients-empty">
                                    <p>No hay ingredientes a√±adidos. A√±ade el primer ingrediente usando el formulario de
                                        arriba.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kitchen Appliances Section -->
                    <div class="form-section">
                        <h3 class="section-title collapsible-title collapsed" id="appliances-section-title">
                            <span class="collapse-icon">‚ñº</span> M√©todo de Preparaci√≥n
                        </h3>
                        <div id="appliances-collapsible-content" class="collapsible-content collapsed">
                            <div class="form-group">
                                <label>Selecciona los aparatos que necesitas (opcional)</label>
                                <div id="kitchen-appliances-chips" class="kitchen-appliances-chips">
                                    <!-- Chips will be added here by JavaScript -->
                                </div>
                                <span class="helper-text">Haz clic en los aparatos que necesitas para esta receta</span>
                            </div>
                        </div>
                    </div>

                    <!-- Addition Sequences Section -->
                    <div class="form-section">
                        <h3 class="section-title collapsible-title" id="sequences-section-title">
                            <span class="collapse-icon">‚ñº</span> Secuencias de Adici√≥n
                        </h3>
                        <div id="sequences-collapsible-content" class="collapsible-content">
                            <p class="helper-text" style="margin-bottom: var(--spacing-md);">Define el orden en que se
                                deben a√±adir los ingredientes durante la preparaci√≥n</p>
                            <div id="sequences-container">
                                <!-- Add sequence form -->
                                <div class="sequence-add-form">
                                    <div class="sequence-form-content">
                                        <div class="sequence-input-group">
                                            <label for="sequence-description">Descripci√≥n</label>
                                            <textarea id="sequence-description" class="form-textarea sequence-input"
                                                placeholder="Ej: A√±adir al sofrito y cocinar" rows="4"
                                                autocomplete="off"></textarea>
                                            <!-- Ingredient buttons (dynamic) -->
                                            <div class="cooking-buttons-section">
                                                <label class="cooking-buttons-label">Ingredientes de la receta:</label>
                                                <div id="ingredient-action-buttons" class="cooking-actions-buttons">
                                                    <!-- Ingredient buttons will be dynamically added here -->
                                                </div>
                                            </div>

                                            <!-- Cooking action buttons (static) -->
                                            <div class="cooking-buttons-section">
                                                <label class="cooking-buttons-label">Acciones de cocina:</label>
                                                <div id="cooking-actions-buttons" class="cooking-actions-buttons">
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="a la plancha">a la plancha</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="a√±adir">a√±adir</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="cocer">cocer</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="cocinar">cocinar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="cocinar al vapor">cocinar al vapor</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="desglasar">desglasar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="fre√≠r">fre√≠r</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="gratinar">gratinar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="guisar">guisar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="hornear">hornear</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="lavar">lavar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="pelar">pelar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="rebozar">rebozar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="reducir">reducir</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="rehogar">rehogar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="reposar">reposar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="saltear">saltear</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="sellar">sellar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="tapar">tapar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="tostar">tostar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="retirar">retirar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="rallar">rallar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="picar">picar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="escaldar">escaldar</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action="y">y</button>
                                                    <button type="button" class="cooking-action-btn"
                                                        data-action=",">,</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sequence-input-group">
                                            <label>Ingredientes</label>
                                            <div id="sequence-ingredients-chips" class="sequence-ingredients-chips">
                                                <!-- Ingredient chips will be populated dynamically -->
                                            </div>
                                            <span class="helper-text">Selecciona uno o m√°s ingredientes</span>
                                        </div>
                                        <div class="sequence-input-group">
                                            <label>Duraci√≥n (opcional)</label>
                                            <div class="time-input-group">
                                                <div class="time-input-item">
                                                    <span class="time-label">Horas</span>
                                                    <input type="number" id="sequence-hours"
                                                        class="form-input time-input" placeholder="0" min="0" max="24"
                                                        autocomplete="off">
                                                </div>
                                                <div class="time-input-item">
                                                    <span class="time-label">Minutos</span>
                                                    <input type="number" id="sequence-minutes"
                                                        class="form-input time-input" placeholder="0" min="0" max="59"
                                                        autocomplete="off">
                                                </div>
                                            </div>
                                            <span class="helper-text">Tiempo estimado para esta secuencia</span>
                                        </div>
                                    </div>
                                    <button type="button" id="add-sequence-btn" class="btn-add-sequence">
                                        ‚ûï A√±adir Secuencia
                                    </button>
                                    <span class="error-message" id="sequence-error"></span>
                                </div>

                                <!-- Sequences list -->
                                <div id="sequences-list" class="sequences-list">
                                    <!-- Sequences will be dynamically added here -->
                                </div>

                                <div id="sequences-empty" class="sequences-empty">
                                    <p>No hay secuencias definidas. Las secuencias son opcionales pero ayudan a
                                        especificar el orden de adici√≥n de ingredientes.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div class="form-section">
                        <h3 class="section-title collapsible-title" id="additional-info-section-title">
                            <span class="collapse-icon">‚ñº</span> Informaci√≥n de Inter√©s
                        </h3>
                        <div id="additional-info-collapsible-content" class="collapsible-content">
                            <div class="form-group">
                                <label for="recipe-author">Autor</label>
                                <input type="text" id="recipe-author" name="author" class="form-input"
                                    placeholder="Ej: Abuela Mar√≠a" maxlength="100" autocomplete="name">
                                <span class="helper-text">Nombre de quien cre√≥ o comparti√≥ esta receta (opcional)</span>
                            </div>

                            <div class="form-group">
                                <label for="recipe-history">Historia</label>
                                <textarea id="recipe-history" name="history" class="form-textarea"
                                    placeholder="Cuenta la historia detr√°s de esta receta..." rows="3"
                                    autocomplete="off"></textarea>
                                <span class="helper-text">Comparte el origen, an√©cdotas o recuerdos relacionados con
                                    esta receta (opcional)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Multimedia Section -->
                    <div class="form-section">
                        <h3 class="section-title">Multimedia</h3>
                        <div id="multimedia-container">
                            <!-- Images Section -->
                            <div class="media-subsection">
                                <h4 class="subsection-title">Im√°genes</h4>
                                <div class="media-upload-area">
                                    <input type="file" id="image-upload" accept="image/*" multiple
                                        style="display: none;">
                                    <button type="button" id="upload-image-btn" class="btn-upload-media">
                                        üì∑ A√±adir Im√°genes
                                    </button>
                                    <span class="helper-text">Formatos: JPEG, PNG, WebP. M√°ximo 10MB por imagen</span>
                                    <span class="error-message" id="image-error"></span>
                                </div>

                                <!-- Images preview grid -->
                                <div id="images-preview" class="media-preview-grid">
                                    <!-- Image previews will be dynamically added here -->
                                </div>

                                <div id="images-empty" class="media-empty">
                                    <p>No hay im√°genes a√±adidas</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" id="cancel-form-btn" class="btn-secondary">
                            Cancelar
                        </button>
                        <button type="submit" id="save-recipe-btn" class="btn-primary">
                            üíæ Guardar Receta
                        </button>
                    </div>
                </form>
            </section>

            <!-- Shopping Lists View -->
            <section id="shopping-lists-view" class="view-container hidden">
                <div class="shopping-lists-header">
                    <div class="shopping-lists-header-title">
                        <h2>üõí Listas de Compra</h2>
                        <button id="close-shopping-lists-btn" class="btn-icon" title="Cerrar"
                            aria-label="Cerrar listas de compra">
                            ‚úï
                        </button>
                    </div>
                    <div class="shopping-lists-buttons">
                        <button id="new-shopping-list-btn" class="btn-primary">
                            ‚ûï Nueva Lista
                        </button>
                        <button id="import-shopping-list-btn" class="btn-primary">
                            üì• Importar Lista
                        </button>
                        <input type="file" id="import-shopping-list-input" accept=".txt" style="display: none;">
                    </div>
                </div>

                <div id="shopping-lists-container" class="shopping-lists-container">
                    <!-- Shopping list cards will be rendered here -->
                </div>

                <div id="shopping-lists-empty" class="empty-state hidden">
                    <p>üõí No tienes listas de compra</p>
                    <p>Crea tu primera lista para empezar</p>
                </div>
            </section>

            <!-- Menus View -->
            <section id="menus-view" class="view-container hidden">
                <div class="shopping-lists-header">
                    <div class="shopping-lists-header-title">
                        <h2>üìã Men√∫s</h2>
                        <button id="close-menus-btn" class="btn-icon" title="Cerrar" aria-label="Cerrar men√∫s">
                            ‚úï
                        </button>
                    </div>
                    <div class="shopping-lists-buttons">
                        <button id="new-menu-btn" class="btn-primary">
                            ‚ûï Nuevo Men√∫
                        </button>
                        <button id="import-menu-btn" class="btn-primary">
                            üì• Importar Men√∫
                        </button>
                        <input type="file" id="import-menu-input" accept=".txt" style="display: none;">
                    </div>
                </div>

                <div id="menus-container" class="shopping-lists-container">
                    <!-- Menu cards will be rendered here -->
                </div>

                <div id="menus-empty" class="empty-state hidden">
                    <p>üìã No tienes men√∫s</p>
                    <p>Crea tu primer men√∫ para empezar</p>
                </div>
            </section>

        </main>
    </div>

    <!-- Category Management Modal -->
    <div id="category-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content category-modal-content">
            <div class="modal-header">
                <h2>Gestionar Categor√≠as</h2>
                <button id="close-category-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <!-- Create new category form -->
                <div class="category-create-section">
                    <h3>Crear Nueva Categor√≠a</h3>
                    <div class="category-form">
                        <div class="form-group">
                            <label for="new-category-name">Nombre</label>
                            <div class="input-with-emoji-and-color">
                                <button type="button" id="open-emoji-picker-btn" class="emoji-prefix-btn"
                                    title="Seleccionar emoji">
                                    <span id="new-category-emoji">üê±</span>
                                </button>
                                <input type="text" id="new-category-name" class="form-input input-with-emoji-field"
                                    placeholder="Nombre de la categor√≠a" maxlength="30">
                                <button type="button" id="open-color-picker-btn" class="color-suffix-btn"
                                    title="Seleccionar color">
                                    <span id="new-category-color-preview" class="color-preview"></span>
                                </button>
                                <input type="hidden" id="new-category-emoji-value" value="üê±">
                                <input type="hidden" id="selected-color">
                            </div>
                        </div>

                        <button id="create-category-btn" class="btn-primary">
                            ‚ûï Crear Categor√≠a
                        </button>
                        <span class="error-message" id="category-error"></span>
                    </div>
                </div>

                <!-- Categories list -->
                <div class="categories-list-section">
                    <h3>Categor√≠as Predefinidas</h3>
                    <div id="predefined-categories-list" class="categories-list">
                        <!-- Predefined categories -->
                    </div>

                    <h3>Categor√≠as Personalizadas</h3>
                    <div id="custom-categories-list" class="categories-list">
                        <!-- Custom categories -->
                    </div>
                    <div id="custom-categories-empty" class="categories-empty">
                        <p>No hay categor√≠as personalizadas. Crea una arriba para empezar.</p>
                    </div>

                    <h3>Categor√≠as Ocultas</h3>
                    <div id="hidden-categories-list" class="categories-list">
                        <!-- Hidden categories -->
                    </div>
                    <div id="hidden-categories-empty" class="categories-empty">
                        <p>No hay categor√≠as ocultas.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="edit-category-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content edit-category-modal-content">
            <div class="modal-header">
                <h2>Editar Categor√≠a</h2>
                <button id="close-edit-category-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="category-form">
                    <div class="form-group">
                        <label for="edit-category-name">Nombre</label>
                        <div class="input-with-emoji-and-color">
                            <button type="button" id="open-edit-emoji-picker-btn" class="emoji-prefix-btn"
                                title="Seleccionar emoji">
                                <span id="edit-category-emoji">üê±</span>
                            </button>
                            <input type="text" id="edit-category-name" class="form-input input-with-emoji-field"
                                placeholder="Nombre de la categor√≠a" maxlength="30">
                            <button type="button" id="open-edit-color-picker-btn" class="color-suffix-btn"
                                title="Seleccionar color">
                                <span id="edit-category-color-preview" class="color-preview"></span>
                            </button>
                            <input type="hidden" id="edit-category-emoji-value" value="üê±">
                            <input type="hidden" id="edit-selected-color">
                            <input type="hidden" id="edit-category-id">
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button id="cancel-edit-category-btn" class="btn-secondary">
                            Cancelar
                        </button>
                        <button id="save-edit-category-btn" class="btn-primary">
                            üíæ Guardar Cambios
                        </button>
                    </div>
                    <span class="error-message" id="edit-category-error"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Picker Modal -->
    <div id="emoji-picker-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content emoji-picker-modal-content">
            <div class="modal-header">
                <h2>Seleccionar Emoji</h2>
                <button id="close-emoji-picker-modal" class="btn-icon">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="emoji-picker-container">
                    <div class="emoji-category">
                        <span class="emoji-category-label">üçï Comida</span>
                        <div class="emoji-grid-modal" data-category="food">
                            <!-- Emojis will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Color Picker Modal -->
    <div id="color-picker-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content color-picker-modal-content">
            <div class="modal-header">
                <h2>Seleccionar Color</h2>
                <button id="close-color-picker-modal" class="btn-icon">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="color-picker-container">
                    <div id="color-palette-modal" class="color-palette-modal">
                        <!-- Color chips will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="image-modal hidden">
        <div class="image-modal-overlay"></div>
        <div class="image-modal-content">
            <button id="close-modal-btn" class="image-modal-close" title="Cerrar">‚úï</button>
            <button id="prev-image-btn" class="image-modal-nav image-modal-prev" title="Anterior">‚Äπ</button>
            <button id="next-image-btn" class="image-modal-nav image-modal-next" title="Siguiente">‚Ä∫</button>
            <img id="modal-image" class="image-modal-img" src="" alt="">
            <div id="modal-image-counter" class="image-modal-counter"></div>
        </div>
    </div>

    <!-- Shopping List Modal -->
    <div id="shopping-list-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shopping-list-modal-title">Nueva Lista de Compra</h2>
                <button id="close-shopping-list-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <!-- List Name -->
                <div class="form-group">
                    <label for="shopping-list-name-input">Nombre de la lista</label>
                    <input type="text" id="shopping-list-name-input" class="form-input"
                        placeholder="Ej: Compra Semanal">
                </div>

                <!-- Items Section -->
                <div class="form-group">
                    <label>Elementos</label>
                    <div class="shopping-list-buttons">
                        <button id="add-shopping-item-btn" class="btn-secondary">
                            ‚ûï A√±adir Elemento
                        </button>
                        <button id="save-shopping-list-btn" class="btn-primary">
                            üíæ Guardar Lista
                        </button>
                    </div>
                    <!-- New items container (appears right below the buttons) -->
                    <div id="shopping-new-items-container">
                        <!-- New items will be added here -->
                    </div>
                    <!-- Existing items container (appears at the bottom) -->
                    <div id="shopping-existing-items-container">
                        <!-- Existing items will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menu-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="menu-modal-title">Nuevo Men√∫</h2>
                <button id="close-menu-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <!-- Menu Name -->
                <div class="form-group">
                    <label for="menu-name-input">Nombre del men√∫</label>
                    <input type="text" id="menu-name-input" class="form-input" placeholder="Ej: Men√∫ Semanal">
                </div>

                <!-- Items Section -->
                <div class="form-group">
                    <label>Elementos del Men√∫</label>
                    <div class="menu-buttons">
                        <button id="add-menu-item-btn" class="btn-secondary">
                            ‚ûï A√±adir Elemento
                        </button>
                        <button id="save-menu-btn" class="btn-primary">
                            üíæ Guardar Men√∫
                        </button>
                    </div>
                    <!-- New items container (appears right below the buttons) -->
                    <div id="menu-new-items-container">
                        <!-- New items will be added here -->
                    </div>
                    <!-- Existing items container (appears at the bottom) -->
                    <div id="menu-existing-items-container">
                        <!-- Existing items will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Select Shopping List Modal -->
    <div id="select-shopping-list-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>A√±adir a Lista de Compra</h2>
                <button id="close-select-list-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <p class="modal-description">Selecciona la lista donde quieres a√±adir este ingrediente:</p>
                <p id="ingredient-to-add-display" class="ingredient-display"></p>

                <div id="shopping-lists-selection" class="shopping-lists-selection">
                    <!-- Shopping lists will be rendered here -->
                </div>

                <div class="modal-actions">
                    <button id="create-new-list-from-ingredient" class="btn-secondary">
                        ‚ûï Crear Nueva Lista
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping List Options Modal -->
    <div id="shopping-list-options-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content shopping-list-options-content">
            <div class="modal-header">
                <h2>Opciones de Lista</h2>
                <button id="close-options-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="options-menu">
                    <button id="option-export" class="option-btn">
                        <span class="option-icon">üíæ</span>
                        <span class="option-text">Exportar</span>
                    </button>
                    <button id="option-copy" class="option-btn">
                        <span class="option-icon">üìã</span>
                        <span class="option-text">Copiar</span>
                    </button>
                    <button id="option-duplicate" class="option-btn">
                        <span class="option-icon">üìë</span>
                        <span class="option-text">Duplicar</span>
                    </button>
                    <button id="option-delete" class="option-btn option-btn-danger">
                        <span class="option-icon">üóëÔ∏è</span>
                        <span class="option-text">Eliminar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Options Modal -->
    <div id="menu-options-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content shopping-list-options-content">
            <div class="modal-header">
                <h2>Opciones de Men√∫</h2>
                <button id="close-menu-options-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="options-menu">
                    <button id="menu-option-export" class="option-btn">
                        <span class="option-icon">üíæ</span>
                        <span class="option-text">Exportar</span>
                    </button>
                    <button id="menu-option-copy" class="option-btn">
                        <span class="option-icon">üìã</span>
                        <span class="option-text">Copiar</span>
                    </button>
                    <button id="menu-option-duplicate" class="option-btn">
                        <span class="option-icon">üìë</span>
                        <span class="option-text">Duplicar</span>
                    </button>
                    <button id="menu-option-delete" class="option-btn option-btn-danger">
                        <span class="option-icon">üóëÔ∏è</span>
                        <span class="option-text">Eliminar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Category Selector Modal -->
    <div id="menu-category-selector-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Seleccionar Categor√≠as</h2>
                <button id="close-category-selector-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <p class="modal-description">Selecciona las categor√≠as de recetas que quieres ver:</p>
                
                <!-- Categories list with selectable badges -->
                <div id="category-selection-list" class="category-selection-list">
                    <!-- Categories will be rendered here dynamically -->
                </div>

                <!-- Empty state -->
                <div id="category-selection-empty" class="empty-state hidden">
                    <p>‚ùå No tienes ninguna receta marcada como men√∫</p>
                    <p>Marca algunas recetas con üçΩÔ∏è para poder a√±adirlas a tus men√∫s</p>
                </div>
            </div>

            <div class="modal-footer">
                <button id="confirm-category-selection-btn" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Recipe Options Modal -->
    <div id="recipe-options-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content shopping-list-options-content">
            <div class="modal-header">
                <h2>Opciones de Receta</h2>
                <button id="close-recipe-options-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="options-menu">
                    <button id="recipe-option-edit" class="option-btn">
                        <span class="option-icon">‚úèÔ∏è</span>
                        <span class="option-text">Editar</span>
                    </button>
                    <button id="recipe-option-duplicate" class="option-btn">
                        <span class="option-icon">üìë</span>
                        <span class="option-text">Duplicar</span>
                    </button>
                    <button id="recipe-option-share" class="option-btn">
                        <span class="option-icon">üì§</span>
                        <span class="option-text">Compartir</span>
                    </button>
                    <button id="recipe-option-pdf" class="option-btn">
                        <span class="option-icon">üìÑ</span>
                        <span class="option-text">Exportar PDF</span>
                    </button>
                    <button id="recipe-option-delete" class="option-btn option-btn-danger">
                        <span class="option-icon">üóëÔ∏è</span>
                        <span class="option-text">Eliminar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Selector Modal -->
    <div id="category-selector-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content category-selector-modal-content">
            <div class="modal-header">
                <h2>Seleccionar Categor√≠a</h2>
                <button id="close-category-selector-modal" class="btn-icon">‚úï</button>
            </div>

            <div class="modal-body">
                <div id="category-selector-chips" class="category-selector-chips">
                    <!-- Categories will be rendered here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container">
            <p class="footer-text">mehaquedadobien - <span id="footer-date"></span></p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="models.js"></script>
    <script src="script.js"></script>
    <script>
        // Set footer date
        const footerDate = document.getElementById('footer-date');
        if (footerDate) {
            const now = new Date();
            const day = now.getDate();
            const monthNames = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            const month = monthNames[now.getMonth()];
            const year = now.getFullYear();
            footerDate.textContent = `${day} - ${month} - ${year}`;
        }
    </script>
</body>

</html>