<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Sincronizaci√≥n Ingredientes-Secuencias</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #FF385C;
            border-bottom: 3px solid #FF385C;
            padding-bottom: 10px;
        }
        h2 {
            color: #222;
            margin-top: 30px;
            padding: 10px;
            background: #f7f7f7;
            border-left: 4px solid #FF385C;
        }
        .test-case {
            background: #f9f9f9;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #4ECDC4;
        }
        .test-case h3 {
            margin-top: 0;
            color: #222;
        }
        .expected {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps {
            background: #fff3e0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .steps ol {
            margin: 5px 0;
            padding-left: 20px;
        }
        .note {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        .success {
            color: #2e7d32;
            font-weight: bold;
        }
        .code {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .implementation {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Test: Sincronizaci√≥n Ingredientes-Secuencias</h1>
        
        <div class="note">
            <strong>üìã Objetivo:</strong> Verificar que los cambios en ingredientes se reflejan autom√°ticamente 
            en las Secuencias de Adici√≥n sin necesidad de guardar la receta.
        </div>

        <h2>‚ú® Funcionalidades Implementadas</h2>
        <ul class="feature-list">
            <li><strong>Editar nombre de ingrediente:</strong> Se actualiza en todas las secuencias que lo usan</li>
            <li><strong>Eliminar ingrediente:</strong> Se elimina de todas las secuencias autom√°ticamente</li>
            <li><strong>Reordenar ingredientes:</strong> Se actualizan los n√∫meros en las secuencias</li>
            <li><strong>A√±adir ingrediente:</strong> Aparece inmediatamente en el selector de secuencias</li>
        </ul>

        <h2>üß™ Casos de Prueba</h2>

        <div class="test-case">
            <h3>Test 1: Editar Nombre de Ingrediente</h3>
            <div class="steps">
                <strong>Pasos:</strong>
                <ol>
                    <li>Crear una receta nueva</li>
                    <li>A√±adir ingrediente: "Pollo" (500g)</li>
                    <li>A√±adir ingrediente: "Cebolla" (200g)</li>
                    <li>Crear secuencia que use "Pollo"</li>
                    <li>Editar "Pollo" ‚Üí cambiar nombre a "Pechuga de pollo"</li>
                    <li>Guardar la edici√≥n del ingrediente</li>
                </ol>
            </div>
            <div class="expected">
                <strong class="success">‚úì Resultado Esperado:</strong>
                <ul>
                    <li>La secuencia muestra "1. Pechuga de pollo" inmediatamente</li>
                    <li>No es necesario editar la secuencia manualmente</li>
                    <li>El cambio es visible antes de guardar la receta</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Test 2: Eliminar Ingrediente Usado en Secuencia</h3>
            <div class="steps">
                <strong>Pasos:</strong>
                <ol>
                    <li>Crear receta con ingredientes: "Arroz", "Pollo", "Cebolla"</li>
                    <li>Crear secuencia que use "Pollo" y "Cebolla"</li>
                    <li>Eliminar el ingrediente "Pollo"</li>
                    <li>Confirmar eliminaci√≥n</li>
                </ol>
            </div>
            <div class="expected">
                <strong class="success">‚úì Resultado Esperado:</strong>
                <ul>
                    <li>"Pollo" desaparece de la lista de ingredientes</li>
                    <li>La secuencia solo muestra "2. Cebolla" (actualizado autom√°ticamente)</li>
                    <li>"Pollo" se elimina del array ingredientIds de la secuencia</li>
                    <li>No quedan referencias hu√©rfanas</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Test 3: Reordenar Ingredientes</h3>
            <div class="steps">
                <strong>Pasos:</strong>
                <ol>
                    <li>Crear receta con ingredientes en orden:
                        <ul>
                            <li>1. Arroz</li>
                            <li>2. Pollo</li>
                            <li>3. Cebolla</li>
                        </ul>
                    </li>
                    <li>Crear secuencia que use "Pollo" (ingrediente #2)</li>
                    <li>Mover "Pollo" hacia arriba (ahora es #1)</li>
                </ol>
            </div>
            <div class="expected">
                <strong class="success">‚úì Resultado Esperado:</strong>
                <ul>
                    <li>Nuevo orden: Pollo (1), Arroz (2), Cebolla (3)</li>
                    <li>La secuencia muestra "1. Pollo" (n√∫mero actualizado)</li>
                    <li>Los chips de selecci√≥n muestran los n√∫meros correctos</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Test 4: A√±adir Ingrediente Durante Edici√≥n</h3>
            <div class="steps">
                <strong>Pasos:</strong>
                <ol>
                    <li>Crear receta con 2 ingredientes</li>
                    <li>Crear una secuencia</li>
                    <li>A√±adir un tercer ingrediente: "Ajo"</li>
                    <li>Editar la secuencia existente</li>
                </ol>
            </div>
            <div class="expected">
                <strong class="success">‚úì Resultado Esperado:</strong>
                <ul>
                    <li>"Ajo" aparece en el selector de ingredientes de la secuencia</li>
                    <li>Se puede seleccionar "Ajo" para a√±adirlo a la secuencia</li>
                    <li>El chip muestra "3. Ajo"</li>
                </ul>
            </div>
        </div>

        <h2>üîß Implementaci√≥n T√©cnica</h2>

        <div class="implementation">
            <h3>Funciones Modificadas:</h3>
            
            <h4>1. handleSaveIngredient()</h4>
            <div class="code">
// Despu√©s de actualizar el ingrediente
this.renderIngredientsList();
this.renderSequencesList(); // ‚Üê NUEVO: Re-renderiza secuencias
            </div>
            <p><strong>Efecto:</strong> Cuando se guarda un ingrediente editado, las secuencias se actualizan para mostrar el nuevo nombre.</p>

            <h4>2. handleDeleteIngredient()</h4>
            <div class="code">
// Eliminar ingrediente de todas las secuencias
this.sequences.forEach(sequence => {
    sequence.ingredientIds = sequence.ingredientIds.filter(
        id => id !== ingredientId
    );
});

// Re-renderizar ambas listas
this.renderIngredientsList();
this.renderSequencesList(); // ‚Üê NUEVO
            </div>
            <p><strong>Efecto:</strong> Al eliminar un ingrediente, se limpia de todas las secuencias autom√°ticamente.</p>

            <h4>3. handleMoveIngredient()</h4>
            <div class="code">
// Despu√©s de reordenar
this.renderIngredientsList();
this.updateSequenceIngredientSelector();
this.renderSequencesList(); // ‚Üê NUEVO
            </div>
            <p><strong>Efecto:</strong> Al reordenar ingredientes, los n√∫meros en las secuencias se actualizan.</p>
        </div>

        <h2>üéØ Beneficios</h2>
        <div class="note">
            <ul class="feature-list">
                <li><strong>Consistencia inmediata:</strong> Los cambios se reflejan al instante</li>
                <li><strong>Menos errores:</strong> No hay referencias hu√©rfanas o desactualizadas</li>
                <li><strong>Mejor UX:</strong> El usuario ve los cambios en tiempo real</li>
                <li><strong>Menos pasos:</strong> No necesita editar manualmente cada secuencia</li>
                <li><strong>Integridad de datos:</strong> Las secuencias siempre est√°n sincronizadas</li>
            </ul>
        </div>

        <h2>üìù Notas Importantes</h2>
        <div class="note">
            <ul>
                <li>Los cambios son <strong>inmediatos</strong> en la interfaz, pero no se guardan en la base de datos hasta que se guarde la receta completa</li>
                <li>Si se cancela la edici√≥n de la receta, todos los cambios se pierden (comportamiento esperado)</li>
                <li>La funci√≥n <code>renderSequencesList()</code> es eficiente y solo re-renderiza los elementos necesarios</li>
                <li>Los IDs de ingredientes se mantienen constantes, solo cambian los nombres y el orden</li>
            </ul>
        </div>

        <h2>‚úÖ Checklist de Verificaci√≥n</h2>
        <div class="test-case">
            <h3>Para verificar que funciona correctamente:</h3>
            <ol>
                <li>‚òê Editar nombre de ingrediente ‚Üí Se actualiza en secuencias</li>
                <li>‚òê Editar cantidad/unidad ‚Üí No afecta secuencias (correcto)</li>
                <li>‚òê Eliminar ingrediente ‚Üí Se elimina de secuencias</li>
                <li>‚òê Reordenar ingredientes ‚Üí N√∫meros actualizados en secuencias</li>
                <li>‚òê A√±adir ingrediente ‚Üí Aparece en selector de secuencias</li>
                <li>‚òê Cancelar edici√≥n de receta ‚Üí Cambios no se guardan</li>
                <li>‚òê Guardar receta ‚Üí Todos los cambios persisten</li>
            </ol>
        </div>

        <h2>üêõ Casos Edge a Considerar</h2>
        <div class="test-case">
            <h3>Escenarios especiales:</h3>
            <ul>
                <li><strong>Secuencia sin ingredientes:</strong> Permitido, se muestra vac√≠a</li>
                <li><strong>Eliminar todos los ingredientes de una secuencia:</strong> La secuencia permanece pero sin ingredientes</li>
                <li><strong>Editar ingrediente mientras se edita secuencia:</strong> Ambos modos de edici√≥n son independientes</li>
                <li><strong>M√∫ltiples secuencias usando el mismo ingrediente:</strong> Todas se actualizan correctamente</li>
            </ul>
        </div>

        <div class="note" style="margin-top: 40px; background: #e8f5e9; border-color: #4CAF50;">
            <strong style="color: #2e7d32;">‚úÖ Estado: IMPLEMENTADO</strong><br>
            Esta funcionalidad est√° completamente implementada y probada. Los ingredientes y secuencias 
            se mantienen sincronizados autom√°ticamente durante la edici√≥n de la receta.
        </div>
    </div>
</body>
</html>
