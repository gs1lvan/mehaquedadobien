<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Unified Time Input</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #667eea;
        }
        .test-case h3 {
            margin-top: 0;
            color: #667eea;
            font-size: 16px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 4px;
            font-family: monospace;
        }
        .result.error {
            background: #ffebee;
            color: #c62828;
        }
        .result.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #4caf50;
            color: white;
        }
        .status.fail {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üß™ Test - Unified Time Input</h1>
    <p>Pruebas de integraci√≥n para la unificaci√≥n de campos de tiempo</p>

    <div class="test-section">
        <h2>‚úÖ Test 1: Crear receta con tiempo total</h2>
        <div class="test-case">
            <h3>Caso 1.1: Tiempo completo (horas y minutos)</h3>
            <p>Crear receta con 2 horas y 30 minutos</p>
            <button onclick="testRecipeWithFullTime()">Ejecutar Test</button>
            <div id="result-1-1" class="result" style="display:none;"></div>
        </div>
        <div class="test-case">
            <h3>Caso 1.2: Solo horas</h3>
            <p>Crear receta con 1 hora</p>
            <button onclick="testRecipeWithHoursOnly()">Ejecutar Test</button>
            <div id="result-1-2" class="result" style="display:none;"></div>
        </div>
        <div class="test-case">
            <h3>Caso 1.3: Solo minutos</h3>
            <p>Crear receta con 45 minutos</p>
            <button onclick="testRecipeWithMinutesOnly()">Ejecutar Test</button>
            <div id="result-1-3" class="result" style="display:none;"></div>
        </div>
        <div class="test-case">
            <h3>Caso 1.4: Sin tiempo</h3>
            <p>Crear receta sin tiempo total</p>
            <button onclick="testRecipeWithNoTime()">Ejecutar Test</button>
            <div id="result-1-4" class="result" style="display:none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚úÖ Test 2: Crear secuencia con duraci√≥n</h2>
        <div class="test-case">
            <h3>Caso 2.1: Duraci√≥n completa (horas y minutos)</h3>
            <p>Crear secuencia con 1 hora y 15 minutos</p>
            <button onclick="testSequenceWithFullDuration()">Ejecutar Test</button>
            <div id="result-2-1" class="result" style="display:none;"></div>
        </div>
        <div class="test-case">
            <h3>Caso 2.2: Solo minutos</h3>
            <p>Crear secuencia con 20 minutos</p>
            <button onclick="testSequenceWithMinutesOnly()">Ejecutar Test</button>
            <div id="result-2-2" class="result" style="display:none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚úÖ Test 3: Formateo para visualizaci√≥n</h2>
        <div class="test-case">
            <h3>Caso 3.1: Formato de visualizaci√≥n</h3>
            <p>Verificar que el formato de visualizaci√≥n es legible</p>
            <button onclick="testFormatTimeForDisplay()">Ejecutar Test</button>
            <div id="result-3-1" class="result" style="display:none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚úÖ Test 4: Parseo y poblaci√≥n de campos</h2>
        <div class="test-case">
            <h3>Caso 4.1: Parseo de strings de tiempo</h3>
            <p>Verificar que se parsean correctamente diferentes formatos</p>
            <button onclick="testParseTimeStrings()">Ejecutar Test</button>
            <div id="result-4-1" class="result" style="display:none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìä Resumen de Tests</h2>
        <button onclick="runAllTests()">‚ñ∂Ô∏è Ejecutar Todos los Tests</button>
        <div id="summary" style="margin-top: 20px;"></div>
    </div>

    <script src="models.js"></script>
    <script>
        // Mock RecipeApp methods for testing
        class TestRecipeApp {
            parseTimeInput(idPrefix) {
                const hours = parseInt(document.getElementById(`${idPrefix}-hours`)?.value) || 0;
                const minutes = parseInt(document.getElementById(`${idPrefix}-minutes`)?.value) || 0;
                
                if (hours > 0 && minutes > 0) {
                    return `${hours}h ${minutes}min`;
                } else if (hours > 0) {
                    return `${hours}h`;
                } else if (minutes > 0) {
                    return `${minutes}min`;
                }
                
                return '';
            }

            populateTimeInput(idPrefix, timeString) {
                const hoursInput = document.getElementById(`${idPrefix}-hours`);
                const minutesInput = document.getElementById(`${idPrefix}-minutes`);
                
                if (!hoursInput || !minutesInput) return;
                
                if (timeString && timeString.trim() !== '') {
                    const hoursMatch = timeString.match(/(\d+)\s*h/);
                    const minutesMatch = timeString.match(/(\d+)\s*min/);
                    
                    hoursInput.value = hoursMatch ? hoursMatch[1] : '';
                    minutesInput.value = minutesMatch ? minutesMatch[1] : '';
                } else {
                    hoursInput.value = '';
                    minutesInput.value = '';
                }
            }

            formatTimeForDisplay(timeString) {
                if (!timeString || timeString.trim() === '') {
                    return '';
                }
                
                const hoursMatch = timeString.match(/(\d+)\s*h/);
                const minutesMatch = timeString.match(/(\d+)\s*min/);
                
                const hours = hoursMatch ? parseInt(hoursMatch[1]) : 0;
                const minutes = minutesMatch ? parseInt(minutesMatch[1]) : 0;
                
                const parts = [];
                
                if (hours > 0) {
                    parts.push(hours === 1 ? '1 hora' : `${hours} horas`);
                }
                
                if (minutes > 0) {
                    parts.push(minutes === 1 ? '1 minuto' : `${minutes} minutos`);
                }
                
                return parts.join(' ');
            }
        }

        const app = new TestRecipeApp();

        // Helper function to create mock inputs
        function createMockInputs(idPrefix) {
            const container = document.createElement('div');
            container.innerHTML = `
                <input type="number" id="${idPrefix}-hours" value="0">
                <input type="number" id="${idPrefix}-minutes" value="0">
            `;
            document.body.appendChild(container);
            return container;
        }

        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isSuccess ? 'result success' : 'result error';
            element.textContent = message;
        }

        // Test 1.1
        function testRecipeWithFullTime() {
            const container = createMockInputs('test-recipe');
            document.getElementById('test-recipe-hours').value = '2';
            document.getElementById('test-recipe-minutes').value = '30';
            
            const result = app.parseTimeInput('test-recipe');
            const expected = '2h 30min';
            const success = result === expected;
            
            showResult('result-1-1', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 1.2
        function testRecipeWithHoursOnly() {
            const container = createMockInputs('test-recipe2');
            document.getElementById('test-recipe2-hours').value = '1';
            document.getElementById('test-recipe2-minutes').value = '0';
            
            const result = app.parseTimeInput('test-recipe2');
            const expected = '1h';
            const success = result === expected;
            
            showResult('result-1-2', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 1.3
        function testRecipeWithMinutesOnly() {
            const container = createMockInputs('test-recipe3');
            document.getElementById('test-recipe3-hours').value = '0';
            document.getElementById('test-recipe3-minutes').value = '45';
            
            const result = app.parseTimeInput('test-recipe3');
            const expected = '45min';
            const success = result === expected;
            
            showResult('result-1-3', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 1.4
        function testRecipeWithNoTime() {
            const container = createMockInputs('test-recipe4');
            document.getElementById('test-recipe4-hours').value = '0';
            document.getElementById('test-recipe4-minutes').value = '0';
            
            const result = app.parseTimeInput('test-recipe4');
            const expected = '';
            const success = result === expected;
            
            showResult('result-1-4', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 2.1
        function testSequenceWithFullDuration() {
            const container = createMockInputs('test-sequence');
            document.getElementById('test-sequence-hours').value = '1';
            document.getElementById('test-sequence-minutes').value = '15';
            
            const result = app.parseTimeInput('test-sequence');
            const expected = '1h 15min';
            const success = result === expected;
            
            showResult('result-2-1', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 2.2
        function testSequenceWithMinutesOnly() {
            const container = createMockInputs('test-sequence2');
            document.getElementById('test-sequence2-hours').value = '0';
            document.getElementById('test-sequence2-minutes').value = '20';
            
            const result = app.parseTimeInput('test-sequence2');
            const expected = '20min';
            const success = result === expected;
            
            showResult('result-2-2', 
                `Resultado: "${result}" | Esperado: "${expected}" ${success ? '‚úì' : '‚úó'}`,
                success
            );
            
            document.body.removeChild(container);
        }

        // Test 3.1
        function testFormatTimeForDisplay() {
            const tests = [
                { input: '2h 30min', expected: '2 horas 30 minutos' },
                { input: '1h', expected: '1 hora' },
                { input: '45min', expected: '45 minutos' },
                { input: '1h 1min', expected: '1 hora 1 minuto' },
                { input: '', expected: '' }
            ];
            
            let allPassed = true;
            let results = [];
            
            tests.forEach(test => {
                const result = app.formatTimeForDisplay(test.input);
                const passed = result === test.expected;
                allPassed = allPassed && passed;
                results.push(`"${test.input}" ‚Üí "${result}" (esperado: "${test.expected}") ${passed ? '‚úì' : '‚úó'}`);
            });
            
            showResult('result-3-1', results.join('\n'), allPassed);
        }

        // Test 4.1
        function testParseTimeStrings() {
            const tests = [
                { input: '2h 30min', expectedHours: '2', expectedMinutes: '30' },
                { input: '1h', expectedHours: '1', expectedMinutes: '' },
                { input: '45min', expectedHours: '', expectedMinutes: '45' }
            ];
            
            let allPassed = true;
            let results = [];
            
            tests.forEach((test, index) => {
                const container = createMockInputs(`test-parse${index}`);
                app.populateTimeInput(`test-parse${index}`, test.input);
                
                const hours = document.getElementById(`test-parse${index}-hours`).value;
                const minutes = document.getElementById(`test-parse${index}-minutes`).value;
                
                const passed = hours === test.expectedHours && minutes === test.expectedMinutes;
                allPassed = allPassed && passed;
                results.push(`"${test.input}" ‚Üí h:${hours}, m:${minutes} (esperado: h:${test.expectedHours}, m:${test.expectedMinutes}) ${passed ? '‚úì' : '‚úó'}`);
                
                document.body.removeChild(container);
            });
            
            showResult('result-4-1', results.join('\n'), allPassed);
        }

        // Run all tests
        function runAllTests() {
            testRecipeWithFullTime();
            testRecipeWithHoursOnly();
            testRecipeWithMinutesOnly();
            testRecipeWithNoTime();
            testSequenceWithFullDuration();
            testSequenceWithMinutesOnly();
            testFormatTimeForDisplay();
            testParseTimeStrings();
            
            setTimeout(() => {
                const summary = document.getElementById('summary');
                summary.innerHTML = '<h3>‚úÖ Todos los tests ejecutados</h3><p>Revisa los resultados arriba para ver el estado de cada test.</p>';
            }, 100);
        }
    </script>
</body>
</html>
