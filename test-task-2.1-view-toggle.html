<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 2.1 - View Toggle Buttons</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f7f7f7;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #222;
            border-bottom: 2px solid #FF385C;
            padding-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #FF385C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #E31C5F;
        }
        .test-controls {
            margin: 20px 0;
        }
        .requirement {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #FF385C;
        }
        .requirement-title {
            font-weight: 600;
            color: #222;
        }
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Task 2.1: Test View Toggle Buttons (Grid/List)</h1>
    
    <div class="test-section">
        <h2>Requirements Being Tested</h2>
        <div class="requirement">
            <div class="requirement-title">Requirement 1.1</div>
            <div class="test-details">THE Recipe App SHALL provide a view toggle control with two options: Grid view and List view</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 1.4</div>
            <div class="test-details">THE Recipe App SHALL persist the selected view mode in local storage</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 1.5</div>
            <div class="test-details">WHEN the user returns to the application, THE Recipe App SHALL restore the previously selected view mode</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <div class="test-controls">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
            <button onclick="resetLocalStorage()">üîÑ Reset LocalStorage</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <script>
        let testResults = [];

        function logResult(testName, passed, message) {
            const result = {
                testName,
                passed,
                message,
                timestamp: new Date().toLocaleTimeString()
            };
            testResults.push(result);
            displayResults();
        }

        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <strong>[${result.timestamp}] ${result.testName}</strong><br>
                    ${result.message}
                `;
                resultsDiv.appendChild(div);
            });

            // Summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'pass' : 'info'}`;
            summaryDiv.innerHTML = `<strong>Summary: ${passed}/${total} tests passed</strong>`;
            resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
        }

        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
        }

        function resetLocalStorage() {
            localStorage.removeItem('viewMode');
            logResult('LocalStorage Reset', true, 'viewMode removed from localStorage');
        }

        async function runAllTests() {
            clearResults();
            
            // Test 1: Check if view toggle buttons exist
            await testViewToggleButtonsExist();
            
            // Test 2: Check initial state
            await testInitialState();
            
            // Test 3: Test grid button click
            await testGridButtonClick();
            
            // Test 4: Test list button click
            await testListButtonClick();
            
            // Test 5: Test active state styling
            await testActiveStateStyling();
            
            // Test 6: Test localStorage persistence
            await testLocalStoragePersistence();
            
            // Test 7: Test view mode restoration
            await testViewModeRestoration();
            
            // Test 8: Test button toggle behavior
            await testButtonToggleBehavior();
        }

        async function testViewToggleButtonsExist() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            
            if (gridBtn && listBtn) {
                logResult(
                    'Test 1: View Toggle Buttons Exist',
                    true,
                    '‚úÖ Both grid and list view toggle buttons are present in the DOM'
                );
            } else {
                logResult(
                    'Test 1: View Toggle Buttons Exist',
                    false,
                    `‚ùå Missing buttons - Grid: ${!!gridBtn}, List: ${!!listBtn}`
                );
            }
        }

        async function testInitialState() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            
            // Check if one button has active class
            const gridActive = gridBtn?.classList.contains('active');
            const listActive = listBtn?.classList.contains('active');
            
            if ((gridActive && !listActive) || (!gridActive && listActive)) {
                logResult(
                    'Test 2: Initial State',
                    true,
                    `‚úÖ Exactly one button is active - Grid: ${gridActive}, List: ${listActive}`
                );
            } else {
                logResult(
                    'Test 2: Initial State',
                    false,
                    `‚ùå Invalid initial state - Grid: ${gridActive}, List: ${listActive}`
                );
            }
        }

        async function testGridButtonClick() {
            const gridBtn = document.getElementById('view-grid-btn');
            const recipesGrid = document.getElementById('recipes-grid');
            const listHeader = document.getElementById('list-view-header');
            
            // Click grid button
            gridBtn?.click();
            
            // Wait for DOM update
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const gridActive = gridBtn?.classList.contains('active');
            const hasListViewClass = recipesGrid?.classList.contains('list-view');
            const headerHidden = listHeader?.classList.contains('hidden');
            
            if (gridActive && !hasListViewClass && headerHidden) {
                logResult(
                    'Test 3: Grid Button Click',
                    true,
                    '‚úÖ Grid button activates grid view correctly (button active, no list-view class, header hidden)'
                );
            } else {
                logResult(
                    'Test 3: Grid Button Click',
                    false,
                    `‚ùå Grid view not activated correctly - Active: ${gridActive}, ListClass: ${hasListViewClass}, HeaderHidden: ${headerHidden}`
                );
            }
        }

        async function testListButtonClick() {
            const listBtn = document.getElementById('view-list-btn');
            const recipesGrid = document.getElementById('recipes-grid');
            const listHeader = document.getElementById('list-view-header');
            
            // Click list button
            listBtn?.click();
            
            // Wait for DOM update
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const listActive = listBtn?.classList.contains('active');
            const hasListViewClass = recipesGrid?.classList.contains('list-view');
            const headerVisible = !listHeader?.classList.contains('hidden');
            
            if (listActive && hasListViewClass && headerVisible) {
                logResult(
                    'Test 4: List Button Click',
                    true,
                    '‚úÖ List button activates list view correctly (button active, list-view class added, header visible)'
                );
            } else {
                logResult(
                    'Test 4: List Button Click',
                    false,
                    `‚ùå List view not activated correctly - Active: ${listActive}, ListClass: ${hasListViewClass}, HeaderVisible: ${headerVisible}`
                );
            }
        }

        async function testActiveStateStyling() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            
            // Test grid button styling
            gridBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const gridStyles = window.getComputedStyle(gridBtn);
            const gridBgColor = gridStyles.backgroundColor;
            
            // Test list button styling
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const listStyles = window.getComputedStyle(listBtn);
            const listBgColor = listStyles.backgroundColor;
            
            // Check if active buttons have different background than inactive
            const gridInactiveStyles = window.getComputedStyle(gridBtn);
            const gridInactiveBg = gridInactiveStyles.backgroundColor;
            
            if (listBgColor !== gridInactiveBg) {
                logResult(
                    'Test 5: Active State Styling',
                    true,
                    `‚úÖ Active button has distinct styling (Active: ${listBgColor}, Inactive: ${gridInactiveBg})`
                );
            } else {
                logResult(
                    'Test 5: Active State Styling',
                    false,
                    `‚ùå Active and inactive buttons have same styling`
                );
            }
        }

        async function testLocalStoragePersistence() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            
            // Clear localStorage first
            localStorage.removeItem('viewMode');
            
            // Click grid button
            gridBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            let storedMode = localStorage.getItem('viewMode');
            const gridPersisted = storedMode === 'grid';
            
            // Click list button
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            storedMode = localStorage.getItem('viewMode');
            const listPersisted = storedMode === 'list';
            
            if (gridPersisted && listPersisted) {
                logResult(
                    'Test 6: LocalStorage Persistence',
                    true,
                    '‚úÖ View mode is correctly persisted to localStorage for both grid and list views'
                );
            } else {
                logResult(
                    'Test 6: LocalStorage Persistence',
                    false,
                    `‚ùå LocalStorage persistence failed - Grid: ${gridPersisted}, List: ${listPersisted}`
                );
            }
        }

        async function testViewModeRestoration() {
            // Set localStorage to list mode
            localStorage.setItem('viewMode', 'list');
            
            // Reload the page would normally test this, but we'll simulate by checking if the app reads it
            const storedMode = localStorage.getItem('viewMode');
            
            if (storedMode === 'list') {
                logResult(
                    'Test 7: View Mode Restoration',
                    true,
                    '‚úÖ View mode can be read from localStorage (actual restoration requires page reload)'
                );
            } else {
                logResult(
                    'Test 7: View Mode Restoration',
                    false,
                    '‚ùå Failed to read view mode from localStorage'
                );
            }
        }

        async function testButtonToggleBehavior() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            
            // Click grid button
            gridBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const gridActive1 = gridBtn?.classList.contains('active');
            const listActive1 = listBtn?.classList.contains('active');
            
            // Click list button
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const gridActive2 = gridBtn?.classList.contains('active');
            const listActive2 = listBtn?.classList.contains('active');
            
            // Verify mutual exclusivity
            const mutuallyExclusive = (gridActive1 && !listActive1) && (!gridActive2 && listActive2);
            
            if (mutuallyExclusive) {
                logResult(
                    'Test 8: Button Toggle Behavior',
                    true,
                    '‚úÖ Buttons are mutually exclusive (only one active at a time)'
                );
            } else {
                logResult(
                    'Test 8: Button Toggle Behavior',
                    false,
                    `‚ùå Buttons not mutually exclusive - Grid1: ${gridActive1}, List1: ${listActive1}, Grid2: ${gridActive2}, List2: ${listActive2}`
                );
            }
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 500);
        });
    </script>

    <!-- Include the main application -->
    <script src="models.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="styles.css">
</body>
</html>
