<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug: Actualizaci√≥n de Ingredientes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #FF385C;
        }
        .test-section {
            background: #f9f9f9;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4ECDC4;
        }
        .step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .step h3 {
            margin-top: 0;
            color: #222;
        }
        .code {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 14px;
        }
        .expected {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #4CAF50;
        }
        .actual {
            background: #fff3e0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #FF9800;
        }
        .error {
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #f44336;
        }
        .success {
            color: #2e7d32;
            font-weight: bold;
        }
        .warning {
            color: #f57c00;
            font-weight: bold;
        }
        ol {
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Debug: Actualizaci√≥n de Ingredientes en Secuencias</h1>
        
        <div class="test-section">
            <h2>üìã Pasos para Reproducir el Problema</h2>
            <ol>
                <li>Abre la aplicaci√≥n principal (index.html)</li>
                <li>Crea una nueva receta</li>
                <li>A√±ade un ingrediente: <strong>"Pollo"</strong> (500g)</li>
                <li>A√±ade otro ingrediente: <strong>"Cebolla"</strong> (200g)</li>
                <li>Ve a la secci√≥n "Secuencias de Adici√≥n"</li>
                <li>Crea una secuencia:
                    <ul>
                        <li>Selecciona "Pollo"</li>
                        <li>Descripci√≥n: "Cocinar el pollo"</li>
                        <li>Duraci√≥n: 30 minutos</li>
                        <li>Click en "‚ûï A√±adir Secuencia"</li>
                    </ul>
                </li>
                <li>Verifica que la secuencia muestra: <code>Pollo</code></li>
                <li>Edita el ingrediente "Pollo":
                    <ul>
                        <li>Click en el bot√≥n de editar (‚úèÔ∏è) del ingrediente</li>
                        <li>Cambia el nombre a: <strong>"Pechuga de pollo"</strong></li>
                        <li>Click en guardar (‚úì)</li>
                    </ul>
                </li>
                <li><strong>Observa la secuencia</strong></li>
            </ol>
        </div>

        <div class="test-section">
            <h2>‚úÖ Comportamiento Esperado</h2>
            <div class="expected">
                <p><strong class="success">Despu√©s de editar el ingrediente:</strong></p>
                <ul>
                    <li>La lista de ingredientes muestra: <code>1. Pechuga de pollo - 500 g</code></li>
                    <li>La secuencia muestra: <code>Pechuga de pollo</code> (actualizado)</li>
                    <li>El selector de ingredientes para nuevas secuencias muestra: <code>Pechuga de pollo (500 g)</code></li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>üîç Verificaci√≥n T√©cnica</h2>
            
            <div class="step">
                <h3>1. Verificar que handleSaveIngredient se ejecuta</h3>
                <p>Abre la consola del navegador (F12) y busca logs como:</p>
                <div class="code">
[App] Ingredient saved: { id: "...", name: "Pechuga de pollo", ... }
                </div>
            </div>

            <div class="step">
                <h3>2. Verificar que renderSequencesList se llama</h3>
                <p>A√±ade un console.log temporal en script.js:</p>
                <div class="code">
renderSequencesList() {
    console.log('[DEBUG] renderSequencesList called');
    console.log('[DEBUG] Current ingredients:', this.ingredients);
    // ... resto del c√≥digo
}
                </div>
            </div>

            <div class="step">
                <h3>3. Verificar el array de ingredientes</h3>
                <p>En la consola, despu√©s de editar, ejecuta:</p>
                <div class="code">
// Asumiendo que la instancia de RecipeApp est√° en window.app
app.ingredients
                </div>
                <div class="expected">
                    <strong>Deber√≠a mostrar:</strong>
                    <pre>[
  { id: "...", name: "Pechuga de pollo", quantity: 500, unit: "g", order: 0 },
  { id: "...", name: "Cebolla", quantity: 200, unit: "g", order: 1 }
]</pre>
                </div>
            </div>

            <div class="step">
                <h3>4. Verificar el array de secuencias</h3>
                <p>En la consola, ejecuta:</p>
                <div class="code">
app.sequences
                </div>
                <div class="expected">
                    <strong>Deber√≠a mostrar:</strong>
                    <pre>[
  {
    id: "...",
    step: 1,
    ingredientIds: ["id-del-pollo"],
    description: "Cocinar el pollo",
    duration: "30min"
  }
]</pre>
                </div>
                <p><strong>Nota:</strong> El ingredientId debe coincidir con el ID del ingrediente actualizado</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üîß Flujo de Actualizaci√≥n</h2>
            <div class="code">
1. Usuario edita ingrediente "Pollo" ‚Üí "Pechuga de pollo"
   ‚Üì
2. handleSaveIngredient(ingredientId, { name: "Pechuga de pollo", ... })
   ‚Üì
3. Busca ingrediente en this.ingredients por ID
   ‚Üì
4. Actualiza: ingredient.name = "Pechuga de pollo"
   ‚Üì
5. Llama a this.renderIngredientsList()
   ‚Üí Re-renderiza lista de ingredientes
   ‚Üì
6. Llama a this.updateSequenceIngredientSelector()
   ‚Üí Actualiza chips del selector (para a√±adir nuevas secuencias)
   ‚Üì
7. Llama a this.renderSequencesList()
   ‚Üí Re-renderiza todas las secuencias existentes
   ‚Üì
8. createSequenceItem() busca ingrediente por ID en this.ingredients
   ‚Üí Encuentra: { id: "...", name: "Pechuga de pollo", ... }
   ‚Üì
9. Crea tag con: tag.textContent = ingredient.name
   ‚Üí Muestra: "Pechuga de pollo"
            </div>
        </div>

        <div class="test-section">
            <h2>‚ùì Posibles Causas del Problema</h2>
            
            <div class="step">
                <h3>Causa 1: El ingrediente no se est√° actualizando</h3>
                <div class="error">
                    <strong>S√≠ntoma:</strong> El array this.ingredients sigue mostrando "Pollo"
                </div>
                <p><strong>Soluci√≥n:</strong> Verificar que la b√∫squeda por ID funciona correctamente</p>
                <div class="code">
const ingredient = this.ingredients.find(ing => ing.id === ingredientId);
console.log('Found ingredient:', ingredient);
                </div>
            </div>

            <div class="step">
                <h3>Causa 2: renderSequencesList no se est√° llamando</h3>
                <div class="error">
                    <strong>S√≠ntoma:</strong> No hay re-renderizado de las secuencias
                </div>
                <p><strong>Soluci√≥n:</strong> A√±adir console.log para verificar</p>
                <div class="code">
console.log('[DEBUG] About to call renderSequencesList');
this.renderSequencesList();
console.log('[DEBUG] renderSequencesList completed');
                </div>
            </div>

            <div class="step">
                <h3>Causa 3: Cache del DOM</h3>
                <div class="error">
                    <strong>S√≠ntoma:</strong> El navegador muestra contenido cacheado
                </div>
                <p><strong>Soluci√≥n:</strong> Forzar recarga completa (Ctrl+Shift+R o Cmd+Shift+R)</p>
            </div>

            <div class="step">
                <h3>Causa 4: Modo de edici√≥n activo</h3>
                <div class="error">
                    <strong>S√≠ntoma:</strong> La secuencia est√° en modo edici√≥n y no se actualiza
                </div>
                <p><strong>Soluci√≥n:</strong> Verificar que this.editingSequenceId === null</p>
                <div class="code">
console.log('Editing sequence ID:', this.editingSequenceId);
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Test Manual Paso a Paso</h2>
            <ol>
                <li>‚òê Crear receta nueva</li>
                <li>‚òê A√±adir ingrediente "Pollo"</li>
                <li>‚òê A√±adir secuencia con "Pollo"</li>
                <li>‚òê Verificar que secuencia muestra "Pollo"</li>
                <li>‚òê Abrir consola (F12)</li>
                <li>‚òê Editar "Pollo" ‚Üí "Pechuga de pollo"</li>
                <li>‚òê Guardar edici√≥n</li>
                <li>‚òê Verificar logs en consola</li>
                <li>‚òê Verificar que lista de ingredientes muestra "Pechuga de pollo"</li>
                <li>‚òê Verificar que secuencia muestra "Pechuga de pollo"</li>
                <li>‚òê Verificar que selector muestra "Pechuga de pollo"</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üí° Soluci√≥n Temporal para Debugging</h2>
            <p>Si el problema persiste, a√±ade estos logs en handleSaveIngredient:</p>
            <div class="code">
handleSaveIngredient(ingredientId, data) {
    console.log('[DEBUG] handleSaveIngredient called');
    console.log('[DEBUG] ingredientId:', ingredientId);
    console.log('[DEBUG] data:', data);
    console.log('[DEBUG] Current ingredients BEFORE:', JSON.parse(JSON.stringify(this.ingredients)));
    
    // ... validaciones ...
    
    const ingredient = this.ingredients.find(ing => ing.id === ingredientId);
    console.log('[DEBUG] Found ingredient:', ingredient);
    
    if (ingredient) {
        ingredient.name = data.name.trim();
        ingredient.quantity = data.quantity || 0;
        ingredient.unit = data.unit;
        console.log('[DEBUG] Updated ingredient:', ingredient);
    }
    
    console.log('[DEBUG] Current ingredients AFTER:', JSON.parse(JSON.stringify(this.ingredients)));
    console.log('[DEBUG] Current sequences:', JSON.parse(JSON.stringify(this.sequences)));
    
    this.editingIngredientId = null;
    this.renderIngredientsList();
    this.updateSequenceIngredientSelector();
    
    console.log('[DEBUG] About to render sequences');
    this.renderSequencesList();
    console.log('[DEBUG] Sequences rendered');
}
            </div>
        </div>

        <div class="test-section" style="background: #e8f5e9; border-color: #4CAF50;">
            <h2>‚úÖ C√≥digo Implementado</h2>
            <p>El c√≥digo ya incluye las siguientes llamadas en handleSaveIngredient:</p>
            <ol>
                <li><code>this.renderIngredientsList()</code> - Actualiza lista de ingredientes</li>
                <li><code>this.updateSequenceIngredientSelector()</code> - Actualiza selector</li>
                <li><code>this.renderSequencesList()</code> - Actualiza secuencias existentes</li>
            </ol>
            <p><strong>Si a√∫n no funciona, usa los pasos de debugging arriba para identificar d√≥nde falla el flujo.</strong></p>
        </div>
    </div>
</body>
</html>
