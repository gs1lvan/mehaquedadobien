<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Import QR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .info {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            word-break: break-all;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        h2 {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>üîç Test de Importaci√≥n QR</h1>
    
    <div class="info">
        <strong>URL Completa:</strong><br>
        <span id="full-url"></span>
    </div>
    
    <div class="info">
        <strong>Hash detectado:</strong><br>
        <span id="hash"></span>
    </div>
    
    <div class="info">
        <strong>Tiene #import=:</strong><br>
        <span id="has-import"></span>
    </div>
    
    <div id="decode-section" style="display: none;">
        <h2>Decodificaci√≥n</h2>
        
        <div class="info">
            <strong>Base64 extra√≠do (primeros 100 chars):</strong><br>
            <span id="base64"></span>
        </div>
        
        <div class="info">
            <strong>Datos decodificados (primeros 500 chars):</strong><br>
            <span id="decoded"></span>
        </div>
        
        <div class="info">
            <strong>Tipo detectado:</strong><br>
            <span id="type"></span>
        </div>
        
        <div id="result" class="info"></div>
    </div>
    
    <h2>Instrucciones</h2>
    <p>1. Genera un QR en tu app</p>
    <p>2. Escan√©alo con tu m√≥vil</p>
    <p>3. Esta p√°gina mostrar√° toda la informaci√≥n de debug</p>

    <script>
        // Mostrar URL completa
        document.getElementById('full-url').textContent = window.location.href;
        
        // Check query parameters first
        const urlParams = new URLSearchParams(window.location.search);
        const importParam = urlParams.get('import');
        
        // Mostrar hash
        const hash = window.location.hash;
        document.getElementById('hash').textContent = importParam ? `?import=${importParam.substring(0, 50)}...` : (hash || '(vac√≠o)');
        
        // Verificar si tiene import
        const hasImport = importParam || hash.startsWith('#import=');
        document.getElementById('has-import').textContent = hasImport ? '‚úÖ S√ç' : '‚ùå NO';
        
        if (hasImport) {
            document.getElementById('decode-section').style.display = 'block';
            
            try {
                // Extraer base64
                const base64Data = importParam || hash.substring(8);
                document.getElementById('base64').textContent = base64Data.substring(0, 100) + '...';
                
                // Decodificar
                const decodedData = decodeURIComponent(atob(base64Data));
                document.getElementById('decoded').textContent = decodedData.substring(0, 500) + '...';
                
                // Detectar tipo
                const isXML = decodedData.trim().startsWith('<');
                document.getElementById('type').textContent = isXML ? 'üìÑ XML' : 'üìã JSON';
                
                // Intentar parsear
                if (isXML) {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(decodedData, 'text/xml');
                    const root = xmlDoc.documentElement;
                    
                    if (root.querySelector('parsererror')) {
                        document.getElementById('result').className = 'info error';
                        document.getElementById('result').innerHTML = '<strong>‚ùå Error:</strong> XML inv√°lido';
                    } else {
                        const name = root.querySelector('name')?.textContent || 'Sin nombre';
                        const ingredientsCount = root.querySelectorAll('ingredients i').length;
                        
                        document.getElementById('result').className = 'info success';
                        document.getElementById('result').innerHTML = `
                            <strong>‚úÖ XML V√°lido</strong><br>
                            Nombre: ${name}<br>
                            Ingredientes: ${ingredientsCount}
                        `;
                    }
                } else {
                    const jsonData = JSON.parse(decodedData);
                    document.getElementById('result').className = 'info success';
                    document.getElementById('result').innerHTML = `
                        <strong>‚úÖ JSON V√°lido</strong><br>
                        Nombre: ${jsonData.name || jsonData.n || 'Sin nombre'}
                    `;
                }
                
            } catch (error) {
                document.getElementById('result').className = 'info error';
                document.getElementById('result').innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>
