<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 3.3 - Sort Indicators</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f7f7f7;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #222;
            border-bottom: 2px solid #FF385C;
            padding-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #FF385C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #E31C5F;
        }
        .test-controls {
            margin: 20px 0;
        }
        .requirement {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #FF385C;
        }
        .requirement-title {
            font-weight: 600;
            color: #222;
        }
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .visual-test {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .visual-test h3 {
            margin-top: 0;
            color: #FF385C;
        }
        .indicator-display {
            font-size: 24px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üß™ Task 3.3: Verify Sort Indicators</h1>
    
    <div class="test-section">
        <h2>Requirements Being Tested</h2>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.1</div>
            <div class="test-details">WHEN sorting by name A-Z, THE Recipe App SHALL display ‚ñ≤ indicator</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.2</div>
            <div class="test-details">WHEN sorting by name Z-A, THE Recipe App SHALL display ‚ñº indicator</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 4.1</div>
            <div class="test-details">WHEN sorting by date newest-first, THE Recipe App SHALL display ‚ñº indicator</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 4.2</div>
            <div class="test-details">WHEN sorting by date oldest-first, THE Recipe App SHALL display ‚ñ≤ indicator</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Additional</div>
            <div class="test-details">Indicators should clear when switching to a different column</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <div class="test-controls">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
            <button onclick="switchToListView()">üìã Switch to List View</button>
            <button onclick="clickNameHeader()">üî§ Click Name Header</button>
            <button onclick="clickDateHeader()">üìÖ Click Date Header</button>
            <button onclick="updateVisualStatus()">üîÑ Update Display</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Visual Verification</h2>
        <div class="visual-test">
            <h3>Current Indicators</h3>
            <div id="indicator-status"></div>
        </div>
        <div class="visual-test">
            <h3>Indicator Styling</h3>
            <div id="indicator-styling"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        let app = null;

        function logResult(testName, passed, message) {
            const result = {
                testName,
                passed,
                message,
                timestamp: new Date().toLocaleTimeString()
            };
            testResults.push(result);
            displayResults();
        }

        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <strong>[${result.timestamp}] ${result.testName}</strong><br>
                    ${result.message}
                `;
                resultsDiv.appendChild(div);
            });

            // Summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'pass' : 'info'}`;
            summaryDiv.innerHTML = `<strong>Summary: ${passed}/${total} tests passed</strong>`;
            resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
        }

        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
        }

        function switchToListView() {
            const listBtn = document.getElementById('view-list-btn');
            listBtn?.click();
            updateVisualStatus();
        }

        function clickNameHeader() {
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            updateVisualStatus();
        }

        function clickDateHeader() {
            const dateHeader = document.getElementById('sort-by-date');
            dateHeader?.click();
            updateVisualStatus();
        }

        function getAppInstance() {
            if (window.app) {
                return window.app;
            }
            return null;
        }

        function getIndicators() {
            const nameIndicator = document.querySelector('#sort-by-name .sort-indicator');
            const dateIndicator = document.querySelector('#sort-by-date .sort-indicator');
            
            return {
                name: nameIndicator?.textContent || '',
                date: dateIndicator?.textContent || '',
                nameElement: nameIndicator,
                dateElement: dateIndicator
            };
        }

        function updateVisualStatus() {
            setTimeout(() => {
                app = getAppInstance();
                const indicators = getIndicators();
                
                const statusDiv = document.getElementById('indicator-status');
                statusDiv.innerHTML = `
                    <p><strong>Current Sort:</strong> ${app?.sortBy || 'unknown'} (${app?.sortOrder || 'unknown'})</p>
                    <div class="indicator-display">
                        <strong>Name Indicator:</strong> "${indicators.name}" ${indicators.name ? '‚úÖ' : '‚ö™'}
                    </div>
                    <div class="indicator-display">
                        <strong>Date Indicator:</strong> "${indicators.date}" ${indicators.date ? '‚úÖ' : '‚ö™'}
                    </div>
                `;

                // Check styling
                if (indicators.nameElement && indicators.dateElement) {
                    const nameStyles = window.getComputedStyle(indicators.nameElement);
                    const dateStyles = window.getComputedStyle(indicators.dateElement);
                    
                    const stylingDiv = document.getElementById('indicator-styling');
                    stylingDiv.innerHTML = `
                        <p><strong>Name Indicator:</strong></p>
                        <p>Font Size: ${nameStyles.fontSize}</p>
                        <p>Color: ${nameStyles.color}</p>
                        <p><strong>Date Indicator:</strong></p>
                        <p>Font Size: ${dateStyles.fontSize}</p>
                        <p>Color: ${dateStyles.color}</p>
                    `;
                }
            }, 200);
        }

        async function runAllTests() {
            clearResults();
            
            // Switch to list view first
            switchToListView();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test 1: Indicator elements exist
            await testIndicatorElementsExist();
            
            // Test 2: Name A-Z shows ‚ñ≤
            await testNameAZIndicator();
            
            // Test 3: Name Z-A shows ‚ñº
            await testNameZAIndicator();
            
            // Test 4: Date newest-first shows ‚ñº
            await testDateNewestIndicator();
            
            // Test 5: Date oldest-first shows ‚ñ≤
            await testDateOldestIndicator();
            
            // Test 6: Indicators clear when switching columns
            await testIndicatorsClearOnSwitch();
            
            // Test 7: Indicator visibility
            await testIndicatorVisibility();
            
            // Test 8: Only one indicator active at a time
            await testOnlyOneIndicatorActive();
            
            // Update visual status
            updateVisualStatus();
        }

        async function testIndicatorElementsExist() {
            const indicators = getIndicators();
            
            if (indicators.nameElement && indicators.dateElement) {
                logResult(
                    'Test 1: Indicator Elements Exist',
                    true,
                    '‚úÖ Both name and date indicator elements exist in the DOM'
                );
            } else {
                logResult(
                    'Test 1: Indicator Elements Exist',
                    false,
                    `‚ùå Missing indicators - Name: ${!!indicators.nameElement}, Date: ${!!indicators.dateElement}`
                );
            }
        }

        async function testNameAZIndicator() {
            // Reset and click name header for A-Z
            app = getAppInstance();
            if (app) {
                app.sortBy = 'date';
                app.sortOrder = 'desc';
                app.renderRecipeList();
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicators = getIndicators();
            
            if (indicators.name === '‚ñ≤') {
                logResult(
                    'Test 2: Name A-Z Shows ‚ñ≤',
                    true,
                    `‚úÖ Name A-Z correctly shows ‚ñ≤ indicator`
                );
            } else {
                logResult(
                    'Test 2: Name A-Z Shows ‚ñ≤',
                    false,
                    `‚ùå Name A-Z shows "${indicators.name}" instead of ‚ñ≤`
                );
            }
        }

        async function testNameZAIndicator() {
            // Click name header again for Z-A
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicators = getIndicators();
            
            if (indicators.name === '‚ñº') {
                logResult(
                    'Test 3: Name Z-A Shows ‚ñº',
                    true,
                    `‚úÖ Name Z-A correctly shows ‚ñº indicator`
                );
            } else {
                logResult(
                    'Test 3: Name Z-A Shows ‚ñº',
                    false,
                    `‚ùå Name Z-A shows "${indicators.name}" instead of ‚ñº`
                );
            }
        }

        async function testDateNewestIndicator() {
            // Click date header for newest-first
            const dateHeader = document.getElementById('sort-by-date');
            dateHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicators = getIndicators();
            
            if (indicators.date === '‚ñº') {
                logResult(
                    'Test 4: Date Newest-First Shows ‚ñº',
                    true,
                    `‚úÖ Date newest-first correctly shows ‚ñº indicator`
                );
            } else {
                logResult(
                    'Test 4: Date Newest-First Shows ‚ñº',
                    false,
                    `‚ùå Date newest-first shows "${indicators.date}" instead of ‚ñº`
                );
            }
        }

        async function testDateOldestIndicator() {
            // Click date header again for oldest-first
            const dateHeader = document.getElementById('sort-by-date');
            dateHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicators = getIndicators();
            
            if (indicators.date === '‚ñ≤') {
                logResult(
                    'Test 5: Date Oldest-First Shows ‚ñ≤',
                    true,
                    `‚úÖ Date oldest-first correctly shows ‚ñ≤ indicator`
                );
            } else {
                logResult(
                    'Test 5: Date Oldest-First Shows ‚ñ≤',
                    false,
                    `‚ùå Date oldest-first shows "${indicators.date}" instead of ‚ñ≤`
                );
            }
        }

        async function testIndicatorsClearOnSwitch() {
            // Set name to A-Z
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            let indicators = getIndicators();
            const nameHasIndicator = indicators.name !== '';
            
            // Switch to date
            const dateHeader = document.getElementById('sort-by-date');
            dateHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            indicators = getIndicators();
            const nameCleared = indicators.name === '';
            const dateHasIndicator = indicators.date !== '';
            
            if (nameHasIndicator && nameCleared && dateHasIndicator) {
                logResult(
                    'Test 6: Indicators Clear on Column Switch',
                    true,
                    `‚úÖ Name indicator cleared when switching to date column`
                );
            } else {
                logResult(
                    'Test 6: Indicators Clear on Column Switch',
                    false,
                    `‚ùå Indicator clearing failed - Name had: ${nameHasIndicator}, Name cleared: ${nameCleared}, Date has: ${dateHasIndicator}`
                );
            }
        }

        async function testIndicatorVisibility() {
            // Click name header
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicators = getIndicators();
            const nameStyles = indicators.nameElement ? window.getComputedStyle(indicators.nameElement) : null;
            const fontSize = nameStyles?.fontSize;
            
            // Check if indicator is visible (has content and reasonable size)
            const isVisible = indicators.name !== '' && fontSize && parseFloat(fontSize) > 0;
            
            if (isVisible) {
                logResult(
                    'Test 7: Indicator Visibility',
                    true,
                    `‚úÖ Indicator is visible (font-size: ${fontSize})`
                );
            } else {
                logResult(
                    'Test 7: Indicator Visibility',
                    false,
                    `‚ùå Indicator not visible - Content: "${indicators.name}", Font-size: ${fontSize}`
                );
            }
        }

        async function testOnlyOneIndicatorActive() {
            // Click name header
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            let indicators = getIndicators();
            const nameActive1 = indicators.name !== '';
            const dateActive1 = indicators.date !== '';
            
            // Click date header
            const dateHeader = document.getElementById('sort-by-date');
            dateHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            indicators = getIndicators();
            const nameActive2 = indicators.name !== '';
            const dateActive2 = indicators.date !== '';
            
            const onlyOneActive = (nameActive1 && !dateActive1) && (!nameActive2 && dateActive2);
            
            if (onlyOneActive) {
                logResult(
                    'Test 8: Only One Indicator Active',
                    true,
                    `‚úÖ Only one indicator active at a time`
                );
            } else {
                logResult(
                    'Test 8: Only One Indicator Active',
                    false,
                    `‚ùå Multiple indicators active - Name1: ${nameActive1}, Date1: ${dateActive1}, Name2: ${nameActive2}, Date2: ${dateActive2}`
                );
            }
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });
    </script>

    <!-- Include the main application -->
    <script src="models.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="styles.css">
    
    <script>
        // Expose app instance to window for testing
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof app !== 'undefined') {
                    window.app = app;
                }
            }, 500);
        });
    </script>
</body>
</html>
