<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Quick Edit Category Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-case {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .test-case h3 {
            margin-top: 0;
            color: #667eea;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #4caf50;
            color: white;
        }
        .status.fail {
            background: #f44336;
            color: white;
        }
        .status.pending {
            background: #ff9800;
            color: white;
        }
        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        .instructions h4 {
            margin-top: 0;
            color: #1976d2;
        }
        .expected {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .expected strong {
            color: #2e7d32;
        }
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .button:hover {
            background: #5568d3;
        }
        .button.secondary {
            background: #6c757d;
        }
        .button.secondary:hover {
            background: #5a6268;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .category-chip {
            display: inline-block;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 20px;
            border: 2px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }
        .category-chip.enabled {
            opacity: 1;
            background: white;
        }
        .category-chip.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f5f5f5;
        }
        .category-chip:hover:not(.disabled) {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üß™ Test: Quick Edit Category Fix</h1>
    
    <div class="test-section">
        <h2>üìã Resumen del Fix</h2>
        <p><strong>Problema:</strong> Las categor√≠as aparec√≠an deshabilitadas en quick edit aunque contuvieran la receta actual.</p>
        <p><strong>Soluci√≥n:</strong> Modificar la l√≥gica de <code>renderCategorySelectorChips()</code> para incluir la receta actual en el conteo de recetas disponibles.</p>
        <p><strong>Archivos modificados:</strong></p>
        <ul>
            <li><code>script.js</code> - Funci√≥n <code>quickEditMeal()</code></li>
            <li><code>script.js</code> - Funci√≥n <code>openCategorySelectorForMenu()</code></li>
            <li><code>script.js</code> - Funci√≥n <code>renderCategorySelectorChips()</code></li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîç Casos de Prueba</h2>
        
        <div class="test-case">
            <h3>Caso 1: Receta √∫nica en categor√≠a <span class="status pending">MANUAL</span></h3>
            <p><strong>Setup:</strong></p>
            <ul>
                <li>Crear categor√≠a "Pasta" con 1 receta: "Carbonara" (menuFriendly: true)</li>
                <li>A√±adir "Carbonara" al men√∫ del lunes</li>
            </ul>
            
            <div class="instructions">
                <h4>üìù Instrucciones:</h4>
                <ol>
                    <li>Abre la aplicaci√≥n principal (index.html)</li>
                    <li>Ve a la secci√≥n de Men√∫s</li>
                    <li>Crea un men√∫ nuevo o abre uno existente</li>
                    <li>A√±ade "Carbonara" al lunes (comida o cena)</li>
                    <li>Haz click en el bot√≥n de editar (‚úèÔ∏è) junto a "Carbonara"</li>
                    <li>Observa el modal de selector de categor√≠as</li>
                </ol>
            </div>
            
            <div class="expected">
                <strong>‚úÖ Resultado esperado:</strong>
                <ul>
                    <li>La categor√≠a "Pasta" debe aparecer <strong>habilitada</strong> (opacidad 1.0)</li>
                    <li>El cursor debe ser "pointer" al pasar sobre "Pasta"</li>
                    <li>Debe ser posible hacer click en "Pasta"</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Caso 2: Receta con otras en la misma categor√≠a <span class="status pending">MANUAL</span></h3>
            <p><strong>Setup:</strong></p>
            <ul>
                <li>Categor√≠a "Pasta" tiene 3 recetas: "Carbonara", "Bolognesa", "Alfredo"</li>
                <li>Todas las recetas tienen menuFriendly: true</li>
                <li>"Carbonara" est√° en el men√∫ del lunes</li>
            </ul>
            
            <div class="instructions">
                <h4>üìù Instrucciones:</h4>
                <ol>
                    <li>Aseg√∫rate de tener 3 recetas en la categor√≠a "Pasta"</li>
                    <li>Todas deben tener el checkbox "Men√∫" marcado</li>
                    <li>A√±ade "Carbonara" al men√∫ del lunes</li>
                    <li>Haz click en editar (‚úèÔ∏è) junto a "Carbonara"</li>
                    <li>Observa el modal de selector de categor√≠as</li>
                </ol>
            </div>
            
            <div class="expected">
                <strong>‚úÖ Resultado esperado:</strong>
                <ul>
                    <li>La categor√≠a "Pasta" debe aparecer <strong>habilitada</strong></li>
                    <li>Debe ser posible seleccionar "Pasta"</li>
                    <li>Al seleccionar "Pasta", debe mostrar las 3 recetas disponibles</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Caso 3: Categor√≠a sin recetas menu-friendly <span class="status pending">MANUAL</span></h3>
            <p><strong>Setup:</strong></p>
            <ul>
                <li>Categor√≠a "Postres" tiene 0 recetas con menuFriendly: true</li>
                <li>"Carbonara" (categor√≠a "Pasta") est√° en el men√∫ del lunes</li>
            </ul>
            
            <div class="instructions">
                <h4>üìù Instrucciones:</h4>
                <ol>
                    <li>Aseg√∫rate de que la categor√≠a "Postres" no tiene recetas con checkbox "Men√∫" marcado</li>
                    <li>A√±ade "Carbonara" al men√∫ del lunes</li>
                    <li>Haz click en editar (‚úèÔ∏è) junto a "Carbonara"</li>
                    <li>Observa el modal de selector de categor√≠as</li>
                </ol>
            </div>
            
            <div class="expected">
                <strong>‚úÖ Resultado esperado:</strong>
                <ul>
                    <li>La categor√≠a "Postres" debe aparecer <strong>deshabilitada</strong> (opacidad 0.4)</li>
                    <li>El cursor debe ser "not-allowed" al pasar sobre "Postres"</li>
                    <li>NO debe ser posible hacer click en "Postres"</li>
                </ul>
            </div>
        </div>

        <div class="test-case">
            <h3>Caso 4: Categor√≠a con otras recetas pero no la actual <span class="status pending">MANUAL</span></h3>
            <p><strong>Setup:</strong></p>
            <ul>
                <li>Categor√≠a "Carne" tiene 2 recetas: "Bistec", "Pollo" (menuFriendly: true)</li>
                <li>"Carbonara" (categor√≠a "Pasta") est√° en el men√∫ del lunes</li>
            </ul>
            
            <div class="instructions">
                <h4>üìù Instrucciones:</h4>
                <ol>
                    <li>Crea 2 recetas en la categor√≠a "Carne" con checkbox "Men√∫" marcado</li>
                    <li>A√±ade "Carbonara" (categor√≠a "Pasta") al men√∫ del lunes</li>
                    <li>Haz click en editar (‚úèÔ∏è) junto a "Carbonara"</li>
                    <li>Observa el modal de selector de categor√≠as</li>
                </ol>
            </div>
            
            <div class="expected">
                <strong>‚úÖ Resultado esperado:</strong>
                <ul>
                    <li>La categor√≠a "Carne" debe aparecer <strong>habilitada</strong></li>
                    <li>Debe ser posible seleccionar "Carne"</li>
                    <li>Al seleccionar "Carne", debe mostrar "Bistec" y "Pollo"</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üé® Simulaci√≥n Visual</h2>
        <p>Esta es una simulaci√≥n de c√≥mo deber√≠an verse las categor√≠as en el selector:</p>
        
        <h3>Antes del Fix (‚ùå Incorrecto)</h3>
        <div>
            <div class="category-chip disabled">üçù Pasta (tiene "Carbonara" pero aparece deshabilitada)</div>
            <div class="category-chip enabled">ü•© Carne (tiene "Bistec" y "Pollo")</div>
            <div class="category-chip disabled">üç∞ Postres (sin recetas menu-friendly)</div>
        </div>
        
        <h3>Despu√©s del Fix (‚úÖ Correcto)</h3>
        <div>
            <div class="category-chip enabled">üçù Pasta (tiene "Carbonara" - ahora habilitada)</div>
            <div class="category-chip enabled">ü•© Carne (tiene "Bistec" y "Pollo")</div>
            <div class="category-chip disabled">üç∞ Postres (sin recetas menu-friendly)</div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Cambios en el C√≥digo</h2>
        
        <h3>1. quickEditMeal() - Almacenar nombre de receta actual</h3>
        <div class="code">// Get current recipe name
const currentRecipeName = mealType === 'lunch' ? (item.lunch || '') : (item.dinner || '');

const tempInput = document.createElement('input');
tempInput.type = 'text';
tempInput.value = currentRecipeName;
tempInput.dataset.menuId = menuId;
tempInput.dataset.itemId = itemId;
tempInput.dataset.mealType = mealType;
tempInput.dataset.dayName = item.name;
tempInput.dataset.isQuickEdit = 'true';
tempInput.dataset.currentRecipeName = currentRecipeName; // ‚úÖ NUEVO</div>

        <h3>2. openCategorySelectorForMenu() - Pasar nombre de receta</h3>
        <div class="code">// Check if this is a quick edit (from menu filter view)
const isQuickEdit = inputElement.dataset.isQuickEdit === 'true';

// Get current recipe name if in quick edit mode
const currentRecipeName = isQuickEdit ? (inputElement.dataset.currentRecipeName || '') : '';

// Render categories in modal
this.renderCategorySelectorChips(false, isQuickEdit, currentRecipeName); // ‚úÖ NUEVO par√°metro</div>

        <h3>3. renderCategorySelectorChips() - Incluir receta actual en conteo</h3>
        <div class="code">renderCategorySelectorChips(preSelectCategory = true, isQuickEdit = false, currentRecipeName = '') {
    // ...
    categories.forEach(category => {
        let hasRecipes = true;
        if (isQuickEdit) {
            const menuRecipes = this.recipes.filter(recipe =>
                recipe.menuFriendly === true && recipe.category === category.id
            );
            
            // ‚úÖ NUEVO: Verificar si la receta actual pertenece a esta categor√≠a
            if (currentRecipeName) {
                const currentRecipe = this.recipes.find(recipe => recipe.name === currentRecipeName);
                if (currentRecipe && currentRecipe.category === category.id) {
                    hasRecipes = true; // La receta actual est√° en esta categor√≠a
                } else {
                    hasRecipes = menuRecipes.length > 0;
                }
            } else {
                hasRecipes = menuRecipes.length > 0;
            }
        }
        // ...
    });
}</div>
    </div>

    <div class="test-section">
        <h2>üìä Checklist de Verificaci√≥n</h2>
        <table>
            <thead>
                <tr>
                    <th>Verificaci√≥n</th>
                    <th>Estado</th>
                    <th>Notas</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Categor√≠a con receta actual aparece habilitada</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Probar Caso 1</td>
                </tr>
                <tr>
                    <td>Categor√≠a con m√∫ltiples recetas aparece habilitada</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Probar Caso 2</td>
                </tr>
                <tr>
                    <td>Categor√≠a sin recetas aparece deshabilitada</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Probar Caso 3</td>
                </tr>
                <tr>
                    <td>Categor√≠a con otras recetas aparece habilitada</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Probar Caso 4</td>
                </tr>
                <tr>
                    <td>No hay errores en consola</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Verificar F12 ‚Üí Console</td>
                </tr>
                <tr>
                    <td>Funcionalidad existente no se rompe</td>
                    <td><span class="status pending">PENDIENTE</span></td>
                    <td>Probar flujo normal de men√∫s</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>üöÄ Pr√≥ximos Pasos</h2>
        <ol>
            <li><strong>Probar manualmente:</strong> Ejecutar todos los casos de prueba en la aplicaci√≥n real</li>
            <li><strong>Verificar consola:</strong> Asegurarse de que no hay errores JavaScript</li>
            <li><strong>Probar edge cases:</strong> Recetas sin categor√≠a, categor√≠as vac√≠as, etc.</li>
            <li><strong>Documentar resultados:</strong> Actualizar este archivo con los resultados de las pruebas</li>
            <li><strong>(Opcional) Implementar soluci√≥n completa:</strong> Ver spec en <code>.kiro/specs/fix-menu-quick-edit-categories/</code></li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üìö Documentaci√≥n Relacionada</h2>
        <ul>
            <li><a href="RESUMEN-FIX-QUICK-EDIT-CATEGORIES.md">RESUMEN-FIX-QUICK-EDIT-CATEGORIES.md</a> - Resumen completo del fix</li>
            <li><a href=".kiro/specs/fix-menu-quick-edit-categories/requirements.md">requirements.md</a> - Requisitos funcionales (EARS)</li>
            <li><a href=".kiro/specs/fix-menu-quick-edit-categories/design.md">design.md</a> - Dise√±o y arquitectura</li>
            <li><a href=".kiro/specs/fix-menu-quick-edit-categories/tasks.md">tasks.md</a> - Plan de implementaci√≥n completo</li>
        </ul>
    </div>

    <script>
        console.log('üß™ Test page loaded');
        console.log('üìù Follow the manual test instructions above');
        console.log('‚úÖ Expected: Categories with current recipe should be enabled');
        console.log('‚ùå Before fix: Categories with only current recipe were disabled');
    </script>
</body>
</html>
