<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 2.2 - List View Header Visibility</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f7f7f7;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #222;
            border-bottom: 2px solid #FF385C;
            padding-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #FF385C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #E31C5F;
        }
        .test-controls {
            margin: 20px 0;
        }
        .requirement {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #FF385C;
        }
        .requirement-title {
            font-weight: 600;
            color: #222;
        }
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .visual-test {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .visual-test h3 {
            margin-top: 0;
            color: #FF385C;
        }
        .measurement {
            font-family: monospace;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Task 2.2: Verify List View Header Visibility</h1>
    
    <div class="test-section">
        <h2>Requirements Being Tested</h2>
        <div class="requirement">
            <div class="requirement-title">Requirement 2.1</div>
            <div class="test-details">WHEN the user selects List view, THE Recipe App SHALL display a header row with column labels</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 2.2</div>
            <div class="test-details">WHEN the user selects Grid view, THE Recipe App SHALL hide the header row</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 2.4</div>
            <div class="test-details">THE Recipe App SHALL align header columns with the corresponding data columns in recipe rows</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <div class="test-controls">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
            <button onclick="switchToListView()">üìã Switch to List View</button>
            <button onclick="switchToGridView()">üî≤ Switch to Grid View</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Visual Verification</h2>
        <div class="visual-test">
            <h3>Header Visibility Status</h3>
            <div id="header-status"></div>
        </div>
        <div class="visual-test">
            <h3>Column Alignment Measurements</h3>
            <div id="alignment-measurements"></div>
        </div>
        <div class="visual-test">
            <h3>Sticky Positioning Test</h3>
            <p>Scroll down to verify the header stays at the top of the viewport</p>
            <div id="sticky-status"></div>
        </div>
    </div>

    <script>
        let testResults = [];

        function logResult(testName, passed, message) {
            const result = {
                testName,
                passed,
                message,
                timestamp: new Date().toLocaleTimeString()
            };
            testResults.push(result);
            displayResults();
        }

        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <strong>[${result.timestamp}] ${result.testName}</strong><br>
                    ${result.message}
                `;
                resultsDiv.appendChild(div);
            });

            // Summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'pass' : 'info'}`;
            summaryDiv.innerHTML = `<strong>Summary: ${passed}/${total} tests passed</strong>`;
            resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
        }

        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
        }

        function switchToListView() {
            const listBtn = document.getElementById('view-list-btn');
            listBtn?.click();
            updateVisualStatus();
        }

        function switchToGridView() {
            const gridBtn = document.getElementById('view-grid-btn');
            gridBtn?.click();
            updateVisualStatus();
        }

        function updateVisualStatus() {
            setTimeout(() => {
                const listHeader = document.getElementById('list-view-header');
                const recipesGrid = document.getElementById('recipes-grid');
                const isListView = recipesGrid?.classList.contains('list-view');
                const headerVisible = listHeader && !listHeader.classList.contains('hidden');
                
                // Update header status
                const statusDiv = document.getElementById('header-status');
                statusDiv.innerHTML = `
                    <p><strong>Current View Mode:</strong> ${isListView ? 'List View' : 'Grid View'}</p>
                    <p><strong>Header Element Exists:</strong> ${!!listHeader ? '‚úÖ Yes' : '‚ùå No'}</p>
                    <p><strong>Header Visible:</strong> ${headerVisible ? '‚úÖ Yes' : '‚ùå No'}</p>
                    <p><strong>Has "hidden" class:</strong> ${listHeader?.classList.contains('hidden') ? '‚ùå Yes' : '‚úÖ No'}</p>
                `;

                // Update alignment measurements
                measureColumnAlignment();

                // Update sticky status
                checkStickyPositioning();
            }, 200);
        }

        function measureColumnAlignment() {
            const listHeader = document.getElementById('list-view-header');
            const recipesGrid = document.getElementById('recipes-grid');
            const firstRecipeCard = recipesGrid?.querySelector('.recipe-card.list-item');
            
            if (!listHeader || !firstRecipeCard) {
                document.getElementById('alignment-measurements').innerHTML = 
                    '<p>‚ö†Ô∏è Cannot measure alignment - header or recipe card not found</p>';
                return;
            }

            // Get header column elements
            const headerImg = listHeader.querySelector('.list-header-img');
            const headerName = listHeader.querySelector('.list-header-name');
            const headerDate = listHeader.querySelector('.list-header-date');
            const headerActions = listHeader.querySelector('.list-header-actions');

            // Get recipe card elements
            const recipeImg = firstRecipeCard.querySelector('.recipe-image');
            const recipeName = firstRecipeCard.querySelector('.recipe-name');
            const recipeDate = firstRecipeCard.querySelector('.recipe-date');
            const recipeShare = firstRecipeCard.querySelector('.recipe-share-btn');

            // Measure widths and positions
            const measurements = {
                headerImg: headerImg ? headerImg.getBoundingClientRect() : null,
                headerName: headerName ? headerName.getBoundingClientRect() : null,
                headerDate: headerDate ? headerDate.getBoundingClientRect() : null,
                headerActions: headerActions ? headerActions.getBoundingClientRect() : null,
                recipeImg: recipeImg ? recipeImg.getBoundingClientRect() : null,
                recipeName: recipeName ? recipeName.getBoundingClientRect() : null,
                recipeDate: recipeDate ? recipeDate.getBoundingClientRect() : null,
                recipeShare: recipeShare ? recipeShare.getBoundingClientRect() : null
            };

            // Calculate alignment differences
            const imgAlignDiff = measurements.headerImg && measurements.recipeImg ? 
                Math.abs(measurements.headerImg.left - measurements.recipeImg.left) : null;
            const nameAlignDiff = measurements.headerName && measurements.recipeName ? 
                Math.abs(measurements.headerName.left - measurements.recipeName.left) : null;
            const dateAlignDiff = measurements.headerDate && measurements.recipeDate ? 
                Math.abs(measurements.headerDate.right - measurements.recipeDate.right) : null;

            const alignmentDiv = document.getElementById('alignment-measurements');
            alignmentDiv.innerHTML = `
                <p><strong>Image Column:</strong></p>
                <div class="measurement">Header Width: ${measurements.headerImg?.width.toFixed(2)}px</div>
                <div class="measurement">Recipe Width: ${measurements.recipeImg?.width.toFixed(2)}px</div>
                <div class="measurement">Left Alignment Diff: ${imgAlignDiff?.toFixed(2)}px</div>
                <p>${imgAlignDiff !== null && imgAlignDiff < 5 ? '‚úÖ Well aligned' : '‚ö†Ô∏è May need adjustment'}</p>

                <p><strong>Name Column:</strong></p>
                <div class="measurement">Header Left: ${measurements.headerName?.left.toFixed(2)}px</div>
                <div class="measurement">Recipe Left: ${measurements.recipeName?.left.toFixed(2)}px</div>
                <div class="measurement">Left Alignment Diff: ${nameAlignDiff?.toFixed(2)}px</div>
                <p>${nameAlignDiff !== null && nameAlignDiff < 5 ? '‚úÖ Well aligned' : '‚ö†Ô∏è May need adjustment'}</p>

                <p><strong>Date Column:</strong></p>
                <div class="measurement">Header Right: ${measurements.headerDate?.right.toFixed(2)}px</div>
                <div class="measurement">Recipe Right: ${measurements.recipeDate?.right.toFixed(2)}px</div>
                <div class="measurement">Right Alignment Diff: ${dateAlignDiff?.toFixed(2)}px</div>
                <p>${dateAlignDiff !== null && dateAlignDiff < 5 ? '‚úÖ Well aligned' : '‚ö†Ô∏è May need adjustment'}</p>
            `;
        }

        function checkStickyPositioning() {
            const listHeader = document.getElementById('list-view-header');
            
            if (!listHeader) {
                document.getElementById('sticky-status').innerHTML = 
                    '<p>‚ùå Header element not found</p>';
                return;
            }

            const styles = window.getComputedStyle(listHeader);
            const position = styles.position;
            const top = styles.top;
            const zIndex = styles.zIndex;

            const stickyDiv = document.getElementById('sticky-status');
            stickyDiv.innerHTML = `
                <div class="measurement">Position: ${position}</div>
                <div class="measurement">Top: ${top}</div>
                <div class="measurement">Z-Index: ${zIndex}</div>
                <p>${position === 'sticky' ? '‚úÖ Sticky positioning enabled' : '‚ö†Ô∏è Not using sticky positioning'}</p>
                <p>${parseInt(zIndex) >= 10 ? '‚úÖ Z-index sufficient' : '‚ö†Ô∏è Z-index may be too low'}</p>
            `;
        }

        async function runAllTests() {
            clearResults();
            
            // Test 1: Header exists in DOM
            await testHeaderExists();
            
            // Test 2: Header hidden in grid view
            await testHeaderHiddenInGridView();
            
            // Test 3: Header visible in list view
            await testHeaderVisibleInListView();
            
            // Test 4: Header has correct structure
            await testHeaderStructure();
            
            // Test 5: Sticky positioning
            await testStickyPositioning();
            
            // Test 6: Column alignment
            await testColumnAlignment();
            
            // Test 7: Header responds to view changes
            await testHeaderRespondsToViewChanges();
            
            // Update visual status
            updateVisualStatus();
        }

        async function testHeaderExists() {
            const listHeader = document.getElementById('list-view-header');
            
            if (listHeader) {
                logResult(
                    'Test 1: Header Exists',
                    true,
                    '‚úÖ List view header element exists in the DOM'
                );
            } else {
                logResult(
                    'Test 1: Header Exists',
                    false,
                    '‚ùå List view header element not found'
                );
            }
        }

        async function testHeaderHiddenInGridView() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listHeader = document.getElementById('list-view-header');
            
            // Switch to grid view
            gridBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            const isHidden = listHeader?.classList.contains('hidden');
            
            if (isHidden) {
                logResult(
                    'Test 2: Header Hidden in Grid View',
                    true,
                    '‚úÖ Header is hidden when in grid view mode'
                );
            } else {
                logResult(
                    'Test 2: Header Hidden in Grid View',
                    false,
                    '‚ùå Header is still visible in grid view mode'
                );
            }
        }

        async function testHeaderVisibleInListView() {
            const listBtn = document.getElementById('view-list-btn');
            const listHeader = document.getElementById('list-view-header');
            
            // Switch to list view
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 200));
            
            const isVisible = listHeader && !listHeader.classList.contains('hidden');
            
            if (isVisible) {
                logResult(
                    'Test 3: Header Visible in List View',
                    true,
                    '‚úÖ Header is visible when in list view mode'
                );
            } else {
                logResult(
                    'Test 3: Header Visible in List View',
                    false,
                    '‚ùå Header is not visible in list view mode'
                );
            }
        }

        async function testHeaderStructure() {
            const listHeader = document.getElementById('list-view-header');
            
            if (!listHeader) {
                logResult('Test 4: Header Structure', false, '‚ùå Header not found');
                return;
            }

            const headerImg = listHeader.querySelector('.list-header-img');
            const headerName = listHeader.querySelector('.list-header-name');
            const headerDate = listHeader.querySelector('.list-header-date');
            const headerActions = listHeader.querySelector('.list-header-actions');

            const hasAllColumns = headerImg && headerName && headerDate && headerActions;

            if (hasAllColumns) {
                logResult(
                    'Test 4: Header Structure',
                    true,
                    '‚úÖ Header has all required column elements (img, name, date, actions)'
                );
            } else {
                logResult(
                    'Test 4: Header Structure',
                    false,
                    `‚ùå Missing header columns - Img: ${!!headerImg}, Name: ${!!headerName}, Date: ${!!headerDate}, Actions: ${!!headerActions}`
                );
            }
        }

        async function testStickyPositioning() {
            const listHeader = document.getElementById('list-view-header');
            
            if (!listHeader) {
                logResult('Test 5: Sticky Positioning', false, '‚ùå Header not found');
                return;
            }

            const styles = window.getComputedStyle(listHeader);
            const position = styles.position;
            const zIndex = parseInt(styles.zIndex);

            if (position === 'sticky' && zIndex >= 10) {
                logResult(
                    'Test 5: Sticky Positioning',
                    true,
                    `‚úÖ Header has sticky positioning (position: ${position}, z-index: ${zIndex})`
                );
            } else {
                logResult(
                    'Test 5: Sticky Positioning',
                    false,
                    `‚ùå Header sticky positioning issue - Position: ${position}, Z-index: ${zIndex}`
                );
            }
        }

        async function testColumnAlignment() {
            const listBtn = document.getElementById('view-list-btn');
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 200));

            const listHeader = document.getElementById('list-view-header');
            const recipesGrid = document.getElementById('recipes-grid');
            const firstRecipeCard = recipesGrid?.querySelector('.recipe-card.list-item');
            
            if (!listHeader || !firstRecipeCard) {
                logResult(
                    'Test 6: Column Alignment',
                    false,
                    '‚ùå Cannot test alignment - header or recipe card not found'
                );
                return;
            }

            const headerImg = listHeader.querySelector('.list-header-img');
            const recipeImg = firstRecipeCard.querySelector('.recipe-image');

            if (!headerImg || !recipeImg) {
                logResult(
                    'Test 6: Column Alignment',
                    false,
                    '‚ùå Cannot measure alignment - column elements not found'
                );
                return;
            }

            const headerRect = headerImg.getBoundingClientRect();
            const recipeRect = recipeImg.getBoundingClientRect();
            const alignmentDiff = Math.abs(headerRect.left - recipeRect.left);

            // Allow 5px tolerance for alignment
            if (alignmentDiff < 5) {
                logResult(
                    'Test 6: Column Alignment',
                    true,
                    `‚úÖ Columns are well aligned (difference: ${alignmentDiff.toFixed(2)}px)`
                );
            } else {
                logResult(
                    'Test 6: Column Alignment',
                    false,
                    `‚ùå Columns misaligned (difference: ${alignmentDiff.toFixed(2)}px)`
                );
            }
        }

        async function testHeaderRespondsToViewChanges() {
            const gridBtn = document.getElementById('view-grid-btn');
            const listBtn = document.getElementById('view-list-btn');
            const listHeader = document.getElementById('list-view-header');
            
            // Test grid view
            gridBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 200));
            const hiddenInGrid = listHeader?.classList.contains('hidden');
            
            // Test list view
            listBtn?.click();
            await new Promise(resolve => setTimeout(resolve, 200));
            const visibleInList = !listHeader?.classList.contains('hidden');
            
            if (hiddenInGrid && visibleInList) {
                logResult(
                    'Test 7: Header Responds to View Changes',
                    true,
                    '‚úÖ Header correctly toggles visibility when switching between views'
                );
            } else {
                logResult(
                    'Test 7: Header Responds to View Changes',
                    false,
                    `‚ùå Header not responding correctly - Hidden in grid: ${hiddenInGrid}, Visible in list: ${visibleInList}`
                );
            }
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });
    </script>

    <!-- Include the main application -->
    <script src="models.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="styles.css">
</body>
</html>
