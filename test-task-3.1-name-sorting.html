<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task 3.1 - Name Column Sorting</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f7f7f7;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin-top: 0;
            color: #222;
            border-bottom: 2px solid #FF385C;
            padding-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #FF385C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #E31C5F;
        }
        .test-controls {
            margin: 20px 0;
        }
        .requirement {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #FF385C;
        }
        .requirement-title {
            font-weight: 600;
            color: #222;
        }
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .visual-test {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .visual-test h3 {
            margin-top: 0;
            color: #FF385C;
        }
        .recipe-order {
            font-family: monospace;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Task 3.1: Test Name Column Sorting</h1>
    
    <div class="test-section">
        <h2>Requirements Being Tested</h2>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.1</div>
            <div class="test-details">WHEN the user clicks the Name column header, THE Recipe App SHALL sort recipes alphabetically by name (A-Z)</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.2</div>
            <div class="test-details">WHEN the user clicks the Name column header again, THE Recipe App SHALL reverse the sort order (Z-A)</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.3</div>
            <div class="test-details">WHEN the user clicks the Name column header a third time, THE Recipe App SHALL reset to the default sort order</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.4</div>
            <div class="test-details">THE Recipe App SHALL perform case-insensitive sorting on recipe names</div>
        </div>
        <div class="requirement">
            <div class="requirement-title">Requirement 3.5</div>
            <div class="test-details">THE Recipe App SHALL maintain the current sort order when filters are applied or removed</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <div class="test-controls">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
            <button onclick="switchToListView()">üìã Switch to List View</button>
            <button onclick="clickNameHeader()">üî§ Click Name Header</button>
            <button onclick="showRecipeOrder()">üìä Show Recipe Order</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Visual Verification</h2>
        <div class="visual-test">
            <h3>Current Sort State</h3>
            <div id="sort-state"></div>
        </div>
        <div class="visual-test">
            <h3>Recipe Order</h3>
            <div id="recipe-order"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        let app = null;

        function logResult(testName, passed, message) {
            const result = {
                testName,
                passed,
                message,
                timestamp: new Date().toLocaleTimeString()
            };
            testResults.push(result);
            displayResults();
        }

        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <strong>[${result.timestamp}] ${result.testName}</strong><br>
                    ${result.message}
                `;
                resultsDiv.appendChild(div);
            });

            // Summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'pass' : 'info'}`;
            summaryDiv.innerHTML = `<strong>Summary: ${passed}/${total} tests passed</strong>`;
            resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
        }

        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
        }

        function switchToListView() {
            const listBtn = document.getElementById('view-list-btn');
            listBtn?.click();
            updateVisualStatus();
        }

        function clickNameHeader() {
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            updateVisualStatus();
        }

        function getAppInstance() {
            // Try to get the app instance from window
            if (window.app) {
                return window.app;
            }
            // If not available, try to find it through the DOM
            return null;
        }

        function updateVisualStatus() {
            setTimeout(() => {
                app = getAppInstance();
                if (!app) {
                    document.getElementById('sort-state').innerHTML = 
                        '<p>‚ö†Ô∏è Cannot access app instance</p>';
                    return;
                }

                const sortStateDiv = document.getElementById('sort-state');
                sortStateDiv.innerHTML = `
                    <p><strong>Sort By:</strong> ${app.sortBy}</p>
                    <p><strong>Sort Order:</strong> ${app.sortOrder}</p>
                    <p><strong>View Mode:</strong> ${app.viewMode}</p>
                `;

                showRecipeOrder();
            }, 200);
        }

        function showRecipeOrder() {
            app = getAppInstance();
            if (!app) {
                document.getElementById('recipe-order').innerHTML = 
                    '<p>‚ö†Ô∏è Cannot access app instance</p>';
                return;
            }

            const recipesGrid = document.getElementById('recipes-grid');
            const recipeCards = recipesGrid?.querySelectorAll('.recipe-card');
            
            if (!recipeCards || recipeCards.length === 0) {
                document.getElementById('recipe-order').innerHTML = 
                    '<p>‚ö†Ô∏è No recipes found</p>';
                return;
            }

            const orderDiv = document.getElementById('recipe-order');
            orderDiv.innerHTML = '<p><strong>Current recipe order (first 10):</strong></p>';
            
            Array.from(recipeCards).slice(0, 10).forEach((card, index) => {
                const nameEl = card.querySelector('.recipe-name');
                const name = nameEl?.textContent || 'Unknown';
                const orderItem = document.createElement('div');
                orderItem.className = 'recipe-order';
                orderItem.textContent = `${index + 1}. ${name}`;
                orderDiv.appendChild(orderItem);
            });
        }

        function getRecipeNames() {
            const recipesGrid = document.getElementById('recipes-grid');
            const recipeCards = recipesGrid?.querySelectorAll('.recipe-card');
            
            if (!recipeCards) return [];
            
            return Array.from(recipeCards).map(card => {
                const nameEl = card.querySelector('.recipe-name');
                return nameEl?.textContent || '';
            });
        }

        function isSortedAZ(names) {
            for (let i = 0; i < names.length - 1; i++) {
                if (names[i].toLowerCase() > names[i + 1].toLowerCase()) {
                    return false;
                }
            }
            return true;
        }

        function isSortedZA(names) {
            for (let i = 0; i < names.length - 1; i++) {
                if (names[i].toLowerCase() < names[i + 1].toLowerCase()) {
                    return false;
                }
            }
            return true;
        }

        async function runAllTests() {
            clearResults();
            
            // Switch to list view first
            switchToListView();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Test 1: Name header exists and is clickable
            await testNameHeaderExists();
            
            // Test 2: First click sorts A-Z
            await testFirstClickAZ();
            
            // Test 3: Second click sorts Z-A
            await testSecondClickZA();
            
            // Test 4: Third click resets to default
            await testThirdClickReset();
            
            // Test 5: Case-insensitive sorting
            await testCaseInsensitiveSorting();
            
            // Test 6: Sort persists with filters
            await testSortPersistsWithFilters();
            
            // Test 7: Sort indicator updates
            await testSortIndicatorUpdates();
            
            // Update visual status
            updateVisualStatus();
        }

        async function testNameHeaderExists() {
            const nameHeader = document.getElementById('sort-by-name');
            const styles = nameHeader ? window.getComputedStyle(nameHeader) : null;
            const cursor = styles?.cursor;
            
            if (nameHeader && cursor === 'pointer') {
                logResult(
                    'Test 1: Name Header Exists',
                    true,
                    '‚úÖ Name column header exists and has pointer cursor'
                );
            } else {
                logResult(
                    'Test 1: Name Header Exists',
                    false,
                    `‚ùå Name header issue - Exists: ${!!nameHeader}, Cursor: ${cursor}`
                );
            }
        }

        async function testFirstClickAZ() {
            app = getAppInstance();
            
            // Reset to default state
            if (app) {
                app.sortBy = 'date';
                app.sortOrder = 'desc';
                app.renderRecipeList();
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // Click name header
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            app = getAppInstance();
            const names = getRecipeNames();
            const isAZ = isSortedAZ(names);
            
            if (app && app.sortBy === 'name' && app.sortOrder === 'asc' && isAZ) {
                logResult(
                    'Test 2: First Click Sorts A-Z',
                    true,
                    `‚úÖ First click sorts A-Z correctly (sortBy: ${app.sortBy}, sortOrder: ${app.sortOrder})`
                );
            } else {
                logResult(
                    'Test 2: First Click Sorts A-Z',
                    false,
                    `‚ùå First click failed - sortBy: ${app?.sortBy}, sortOrder: ${app?.sortOrder}, isAZ: ${isAZ}`
                );
            }
        }

        async function testSecondClickZA() {
            // Click name header again
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            app = getAppInstance();
            const names = getRecipeNames();
            const isZA = isSortedZA(names);
            
            if (app && app.sortBy === 'name' && app.sortOrder === 'desc' && isZA) {
                logResult(
                    'Test 3: Second Click Sorts Z-A',
                    true,
                    `‚úÖ Second click sorts Z-A correctly (sortBy: ${app.sortBy}, sortOrder: ${app.sortOrder})`
                );
            } else {
                logResult(
                    'Test 3: Second Click Sorts Z-A',
                    false,
                    `‚ùå Second click failed - sortBy: ${app?.sortBy}, sortOrder: ${app?.sortOrder}, isZA: ${isZA}`
                );
            }
        }

        async function testThirdClickReset() {
            // Click name header a third time
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            app = getAppInstance();
            
            // Check if it resets to default (date, desc)
            if (app && app.sortBy === 'date' && app.sortOrder === 'desc') {
                logResult(
                    'Test 4: Third Click Resets to Default',
                    true,
                    `‚úÖ Third click resets to default (sortBy: ${app.sortBy}, sortOrder: ${app.sortOrder})`
                );
            } else {
                logResult(
                    'Test 4: Third Click Resets to Default',
                    false,
                    `‚ùå Third click failed to reset - sortBy: ${app?.sortBy}, sortOrder: ${app?.sortOrder}`
                );
            }
        }

        async function testCaseInsensitiveSorting() {
            // Click name header to sort A-Z
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const names = getRecipeNames();
            
            // Check if sorting is case-insensitive
            let caseInsensitive = true;
            for (let i = 0; i < names.length - 1; i++) {
                const current = names[i].toLowerCase();
                const next = names[i + 1].toLowerCase();
                if (current > next) {
                    caseInsensitive = false;
                    break;
                }
            }
            
            if (caseInsensitive) {
                logResult(
                    'Test 5: Case-Insensitive Sorting',
                    true,
                    '‚úÖ Sorting is case-insensitive'
                );
            } else {
                logResult(
                    'Test 5: Case-Insensitive Sorting',
                    false,
                    '‚ùå Sorting is case-sensitive'
                );
            }
        }

        async function testSortPersistsWithFilters() {
            // Set sort to name A-Z
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            app = getAppInstance();
            const sortByBefore = app?.sortBy;
            const sortOrderBefore = app?.sortOrder;
            
            // Apply a filter
            const filterChip = document.querySelector('.filter-chip[data-category="carne"]');
            filterChip?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            app = getAppInstance();
            const sortByAfter = app?.sortBy;
            const sortOrderAfter = app?.sortOrder;
            
            // Remove filter
            filterChip?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            if (sortByBefore === sortByAfter && sortOrderBefore === sortOrderAfter) {
                logResult(
                    'Test 6: Sort Persists with Filters',
                    true,
                    `‚úÖ Sort order maintained when filters applied/removed`
                );
            } else {
                logResult(
                    'Test 6: Sort Persists with Filters',
                    false,
                    `‚ùå Sort changed - Before: ${sortByBefore}/${sortOrderBefore}, After: ${sortByAfter}/${sortOrderAfter}`
                );
            }
        }

        async function testSortIndicatorUpdates() {
            // Click name header to sort A-Z
            const nameHeader = document.getElementById('sort-by-name');
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const nameIndicator = document.querySelector('#sort-by-name .sort-indicator');
            const indicatorAZ = nameIndicator?.textContent;
            
            // Click again to sort Z-A
            nameHeader?.click();
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const indicatorZA = nameIndicator?.textContent;
            
            if (indicatorAZ === '‚ñ≤' && indicatorZA === '‚ñº') {
                logResult(
                    'Test 7: Sort Indicator Updates',
                    true,
                    `‚úÖ Sort indicators update correctly (A-Z: ${indicatorAZ}, Z-A: ${indicatorZA})`
                );
            } else {
                logResult(
                    'Test 7: Sort Indicator Updates',
                    false,
                    `‚ùå Sort indicators incorrect - A-Z: ${indicatorAZ}, Z-A: ${indicatorZA}`
                );
            }
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });
    </script>

    <!-- Include the main application -->
    <script src="models.js"></script>
    <script src="script.js"></script>
    <link rel="stylesheet" href="styles.css">
    
    <script>
        // Expose app instance to window for testing
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof app !== 'undefined') {
                    window.app = app;
                }
            }, 500);
        });
    </script>
</body>
</html>
