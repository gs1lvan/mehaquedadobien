<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Secuencias sin Ingredientes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .sequence-display {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>üß™ Test: Secuencias sin Ingredientes</h1>
    
    <div class="test-section">
        <h2>Objetivo del Test</h2>
        <p>Verificar que se pueden crear secuencias de preparaci√≥n sin seleccionar ingredientes.</p>
        <div class="info test-result">
            <strong>Cambio implementado:</strong> Se elimin√≥ la validaci√≥n que requer√≠a al menos un ingrediente al crear una secuencia.
        </div>
    </div>

    <div class="test-section">
        <h2>Test 1: Crear Secuencia sin Ingredientes</h2>
        <p>Intentar crear una secuencia con descripci√≥n pero sin ingredientes seleccionados.</p>
        <button onclick="runTest1()">‚ñ∂Ô∏è Ejecutar Test 1</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Crear Secuencia con Ingredientes</h2>
        <p>Verificar que las secuencias con ingredientes siguen funcionando correctamente.</p>
        <button onclick="runTest2()">‚ñ∂Ô∏è Ejecutar Test 2</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Crear M√∫ltiples Secuencias Mixtas</h2>
        <p>Crear varias secuencias, algunas con ingredientes y otras sin ellos.</p>
        <button onclick="runTest3()">‚ñ∂Ô∏è Ejecutar Test 3</button>
        <div id="test3-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Validaci√≥n del Modelo</h2>
        <p>Verificar que el modelo Sequence acepta arrays vac√≠os de ingredientes.</p>
        <button onclick="runTest4()">‚ñ∂Ô∏è Ejecutar Test 4</button>
        <div id="test4-result"></div>
    </div>

    <div class="test-section">
        <h2>Casos de Uso Pr√°cticos</h2>
        <div class="info test-result">
            <strong>Ejemplos de secuencias sin ingredientes espec√≠ficos:</strong>
            <ul>
                <li>üî• "Precalentar el horno a 180¬∞C"</li>
                <li>üßπ "Preparar y limpiar el √°rea de trabajo"</li>
                <li>‚è∞ "Dejar reposar la masa durante 30 minutos"</li>
                <li>üçΩÔ∏è "Preparar los platos para servir"</li>
                <li>‚ùÑÔ∏è "Enfriar en el refrigerador"</li>
            </ul>
        </div>
    </div>

    <script src="models.js"></script>
    <script>
        // Mock simple de RecipeApp para testing
        class MockRecipeApp {
            constructor() {
                this.sequences = [];
                this.ingredients = [];
            }

            // Simular la funci√≥n handleAddSequence sin validaci√≥n de ingredientes
            addSequence(ingredientIds, description, duration) {
                const sequence = new Sequence({
                    step: this.sequences.length + 1,
                    ingredientIds: ingredientIds,
                    description: description,
                    duration: duration
                });
                this.sequences.push(sequence);
                return sequence;
            }

            addIngredient(name, quantity, unit) {
                const ingredient = {
                    id: `ing_${Date.now()}_${Math.random()}`,
                    name: name,
                    quantity: quantity,
                    unit: unit
                };
                this.ingredients.push(ingredient);
                return ingredient;
            }
        }

        let app;

        function resetApp() {
            app = new MockRecipeApp();
        }

        function displaySequence(sequence) {
            return `
                <div class="sequence-display">
                    <strong>Paso ${sequence.step}:</strong> ${sequence.description || '(sin descripci√≥n)'}<br>
                    <strong>Ingredientes:</strong> ${sequence.ingredientIds.length > 0 ? sequence.ingredientIds.join(', ') : 'Ninguno'}<br>
                    <strong>Duraci√≥n:</strong> ${sequence.duration || 'No especificada'}
                </div>
            `;
        }

        function runTest1() {
            resetApp();
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<p>‚è≥ Ejecutando test...</p>';

            try {
                // Intentar crear secuencia sin ingredientes
                const sequence = app.addSequence(
                    [], // Sin ingredientes
                    'Precalentar el horno a 180¬∞C',
                    '10min'
                );

                resultDiv.innerHTML = `
                    <div class="success test-result">
                        ‚úÖ <strong>Test 1 PASADO</strong><br>
                        Se cre√≥ exitosamente una secuencia sin ingredientes.
                    </div>
                    ${displaySequence(sequence)}
                    <div class="info test-result">
                        <strong>Validaci√≥n:</strong> El array de ingredientIds est√° vac√≠o: <code>${JSON.stringify(sequence.ingredientIds)}</code>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error test-result">
                        ‚ùå <strong>Test 1 FALLIDO</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        function runTest2() {
            resetApp();
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<p>‚è≥ Ejecutando test...</p>';

            try {
                // A√±adir ingredientes primero
                const ing1 = app.addIngredient('Pollo', '500', 'g');
                const ing2 = app.addIngredient('Cebolla', '1', 'unidad');

                // Crear secuencia con ingredientes
                const sequence = app.addSequence(
                    [ing1.id, ing2.id],
                    'Cortar el pollo y la cebolla en trozos',
                    '5min'
                );

                resultDiv.innerHTML = `
                    <div class="success test-result">
                        ‚úÖ <strong>Test 2 PASADO</strong><br>
                        Se cre√≥ exitosamente una secuencia con ingredientes.
                    </div>
                    ${displaySequence(sequence)}
                    <div class="info test-result">
                        <strong>Ingredientes a√±adidos:</strong> ${app.ingredients.length}<br>
                        <strong>IDs en secuencia:</strong> <code>${JSON.stringify(sequence.ingredientIds)}</code>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error test-result">
                        ‚ùå <strong>Test 2 FALLIDO</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        function runTest3() {
            resetApp();
            const resultDiv = document.getElementById('test3-result');
            resultDiv.innerHTML = '<p>‚è≥ Ejecutando test...</p>';

            try {
                // A√±adir algunos ingredientes
                const ing1 = app.addIngredient('Arroz', '200', 'g');
                const ing2 = app.addIngredient('Agua', '400', 'ml');

                // Crear secuencias mixtas
                const seq1 = app.addSequence([], 'Precalentar el horno a 180¬∞C', '10min');
                const seq2 = app.addSequence([ing1.id], 'Lavar el arroz', '2min');
                const seq3 = app.addSequence([], 'Preparar la bandeja de horno', '1min');
                const seq4 = app.addSequence([ing1.id, ing2.id], 'Cocinar el arroz con agua', '20min');
                const seq5 = app.addSequence([], 'Dejar reposar 5 minutos', '5min');

                let html = `
                    <div class="success test-result">
                        ‚úÖ <strong>Test 3 PASADO</strong><br>
                        Se crearon ${app.sequences.length} secuencias mixtas exitosamente.
                    </div>
                `;

                app.sequences.forEach(seq => {
                    html += displaySequence(seq);
                });

                html += `
                    <div class="info test-result">
                        <strong>Resumen:</strong><br>
                        ‚Ä¢ Secuencias sin ingredientes: ${app.sequences.filter(s => s.ingredientIds.length === 0).length}<br>
                        ‚Ä¢ Secuencias con ingredientes: ${app.sequences.filter(s => s.ingredientIds.length > 0).length}<br>
                        ‚Ä¢ Total de secuencias: ${app.sequences.length}
                    </div>
                `;

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error test-result">
                        ‚ùå <strong>Test 3 FALLIDO</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        function runTest4() {
            const resultDiv = document.getElementById('test4-result');
            resultDiv.innerHTML = '<p>‚è≥ Ejecutando test...</p>';

            try {
                // Test directo del modelo Sequence
                const seq1 = new Sequence({
                    step: 1,
                    ingredientIds: [], // Array vac√≠o
                    description: 'Test sin ingredientes',
                    duration: '5min'
                });

                const seq2 = new Sequence({
                    step: 2,
                    ingredientIds: ['ing_1', 'ing_2'], // Con ingredientes
                    description: 'Test con ingredientes',
                    duration: '10min'
                });

                resultDiv.innerHTML = `
                    <div class="success test-result">
                        ‚úÖ <strong>Test 4 PASADO</strong><br>
                        El modelo Sequence acepta correctamente arrays vac√≠os de ingredientes.
                    </div>
                    <div class="info test-result">
                        <strong>Secuencia 1 (sin ingredientes):</strong><br>
                        <code>${JSON.stringify(seq1.toJSON(), null, 2)}</code>
                    </div>
                    <div class="info test-result">
                        <strong>Secuencia 2 (con ingredientes):</strong><br>
                        <code>${JSON.stringify(seq2.toJSON(), null, 2)}</code>
                    </div>
                    <div class="success test-result">
                        ‚úÖ Ambas secuencias pasaron la validaci√≥n del modelo.
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error test-result">
                        ‚ùå <strong>Test 4 FALLIDO</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        // Ejecutar todos los tests autom√°ticamente al cargar
        window.addEventListener('load', () => {
            console.log('üß™ P√°gina de test cargada. Haz clic en los botones para ejecutar los tests.');
        });
    </script>
</body>
</html>
